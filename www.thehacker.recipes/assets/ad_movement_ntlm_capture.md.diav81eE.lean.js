import{_ as l,c as o,a5 as c,G as t,w as i,B as r,o as d,j as e,a as s}from"./chunks/framework.B5CpDqM0.js";const f=JSON.parse('{"title":"Capture","description":"","frontmatter":{"authors":"ShutdownRepo, sckdev"},"headers":[],"relativePath":"ad/movement/ntlm/capture.md","filePath":"ad/movement/ntlm/capture.md","lastUpdated":1724982529000}'),p={name:"ad/movement/ntlm/capture.md"};function k(g,a,u,m,b,y){const n=r("PluginTabsTab"),h=r("PluginTabs");return d(),o("div",null,[a[2]||(a[2]=c('<h1 id="capture" tabindex="-1">Capture <a class="header-anchor" href="#capture" aria-label="Permalink to &quot;Capture&quot;">​</a></h1><h2 id="theory" tabindex="-1">Theory <a class="header-anchor" href="#theory" aria-label="Permalink to &quot;Theory&quot;">​</a></h2><p>After successfully <a href="./../mitm-and-coerced-authentications/">forcing a victim to authenticate</a> with LM or NTLM to an attacker&#39;s server, the attacker can try to recover credentials by capturing and <a href="./../credentials/cracking">cracking the hash</a> (LM or NTLM hash, a.k.a. response) sent by the victim.</p><h2 id="practice" tabindex="-1">Practice <a class="header-anchor" href="#practice" aria-label="Permalink to &quot;Practice&quot;">​</a></h2><div class="tip custom-block"><p>NTLM capture can be combined with any forced authentication attack. Testers should dissociate the name poisoning features that Responder and Inveigh offer from their capturing features. Those tools can be combined with others offering different &quot;authentication forcing&quot; attacks (like <a href="./../mitm-and-coerced-authentications/#ipv6-dns-poisoning">IPv6 + name poisoning</a>, <a href="./../mitm-and-coerced-authentications/#ms-rprn-abuse">MS-RPRN abuse</a> and so on).</p></div><p><a href="https://github.com/SpiderLabs/Responder" target="_blank" rel="noreferrer">Responder</a> (Python) and <a href="https://github.com/Kevin-Robertson/Inveigh" target="_blank" rel="noreferrer">Inveigh</a> (Powershell) are great tools able to do name poisoning for forced authentication attacks, but also able to capture responses (LM or NTLM hashes) by starting servers waiting for incoming authentications. Once those listening servers are up and ready, the tester can initiate the <a href="./../mitm-and-coerced-authentications/">forced authentication attack</a>.</p><div class="tip custom-block"><p>In order to help the later <a href="./../credentials/cracking#tips-and-tricks">cracking process</a>, testers need to set the NTLM challenge sent to victims to <code>1122334455667788</code>.</p><p>For Inveigh, it can be defined with a command-line argument. For Responder, testers need to edit the configuration file.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sed</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;s/ Random/ 1122334455667788/g&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /PATH/TO/Responder/Responder.conf</span></span></code></pre></div></div>',7)),t(h,null,{default:i(()=>[t(n,{label:"Responder"},{default:i(()=>a[0]||(a[0]=[e("p",null,[s("From UNIX-like systems, "),e("a",{href:"https://github.com/lgandx/Responder",target:"_blank",rel:"noreferrer"},"Responder"),s(" (Python) can be used to start servers listening for NTLM authentications over many protocols (SMB, HTTP, LDAP, FTP, POP3, IMAP, SMTP, ...). Depending on the authenticating principal's configuration, the NTLM authentication can sometimes be downgraded with "),e("code",null,"--lm"),s(" and "),e("code",null,"--disable-ess"),s(" in order to obtain NTLMv1 responses.")],-1),e("div",{class:"language-bash vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"bash"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[e("code",null,[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"responder"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --interface"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "eth0"'),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --analyze")]),s(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"responder"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -I"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "eth0"'),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -A")]),s(`
`),e("span",{class:"line"}),s(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# with downgrading")]),s(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"responder"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --interface"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "eth0"'),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --analyze"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --lm"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --disable-ess")])])])],-1),e("p",null,[s("Testers should try to force a LM hashing downgrade with Responder. LM and NTLMv1 responses (a.k.a. LM/NTLMv1 hashes) from Responder can easily be cracked with "),e("a",{href:"https://crack.sh/netntlm/",target:"_blank",rel:"noreferrer"},"crack.sh"),s(". The "),e("a",{href:"https://github.com/evilmog/ntlmv1-multi",target:"_blank",rel:"noreferrer"},"ntlmv1-multi"),s(" tool (Python) can be used to convert captured responses to crackable formats by hashcat, "),e("a",{href:"https://crack.sh/netntlm/",target:"_blank",rel:"noreferrer"},"crack.sh"),s(" and so on.")],-1),e("div",{class:"language-bash vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"bash"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[e("code",null,[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"ntlmv1-multi"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --ntlmv1"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," SV01"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"::BREAKING.BAD:AD1235DEAC142CD5FC2D123ADCF51A111ADF45C2345ADCF5:AD1235DEAC142CD5FC2D123ADCF51A111ADF45C2345ADCF5:1122334455667788")])])])],-1),e("div",{class:"success custom-block"},[e("p",null,[s("Machine account NT hashes can be used with the "),e("a",{href:"./../kerberos/forged-tickets/silver"},"Silver Ticket"),s(" or "),e("a",{href:"./../kerberos/delegations/s4u2self-abuse"},"S4U2self abuse"),s(" techniques to gain admin access to it.")])],-1),e("div",{class:"tip custom-block"},[e("p",null,"There are cases where a downgrade attempt will fail and the capture authentication will not be shown. Testers should always try to capture authentication with and without downgrading.")],-1)])),_:1}),t(n,{label:"Inveigh"},{default:i(()=>a[1]||(a[1]=[e("p",null,"Start poisoning LLMNR, NBT-NS and mDNS with a custom challenge, enable HTTPS capturing, enable proxy server authentication captures",-1),e("div",{class:"language-powershell vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"powershell"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[e("code",null,[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".\\"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"Inveigh.exe"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"Challenge "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1122334455667788"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"ConsoleOutput Y "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"LLMNR Y "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"NBNS Y "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"mDNS Y "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"HTTPS Y "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"Proxy Y")])])])],-1)])),_:1})]),_:1})])}const C=l(p,[["render",k]]);export{f as __pageData,C as default};
