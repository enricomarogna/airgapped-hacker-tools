import{_ as k,c as r,j as s,a as i,G as e,w as t,a5 as p,B as h,o as d}from"./chunks/framework.B5CpDqM0.js";const m=JSON.parse('{"title":"DNS","description":"","frontmatter":{"authors":"CravateRouge, Hackndo, Pri3st, ShutdownRepo, mpgn"},"headers":[],"relativePath":"ad/recon/dns.md","filePath":"ad/recon/dns.md","lastUpdated":1724982529000}'),o={name:"ad/recon/dns.md"};function F(g,a,c,y,u,E){const l=h("PluginTabsTab"),n=h("PluginTabs");return d(),r("div",null,[a[6]||(a[6]=s("h1",{id:"dns",tabindex:"-1"},[i("DNS "),s("a",{class:"header-anchor",href:"#dns","aria-label":'Permalink to "DNS"'},"​")],-1)),a[7]||(a[7]=s("h2",{id:"finding-domain-controllers",tabindex:"-1"},[i("Finding Domain Controllers "),s("a",{class:"header-anchor",href:"#finding-domain-controllers","aria-label":'Permalink to "Finding Domain Controllers"'},"​")],-1)),a[8]||(a[8]=s("p",null,"AD-DS (Active Directory Domain Services) rely on DNS SRV RR (service location resource records). Those records can be queried to find the location of some servers: the global catalog, LDAP servers, the Kerberos KDC and so on.",-1)),e(n,null,{default:t(()=>[e(l,{label:"dnsutils"},{default:t(()=>a[0]||(a[0]=[s("p",null,[i("nslookup is a DNS client that can be used to query SRV records. It usually comes with the "),s("a",{href:"https://packages.debian.org/buster/dnsutils",target:"_blank",rel:"noreferrer"},"dnsutils"),i(" package.")],-1),s("div",{class:"language-bash vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# find the PDC (Principal Domain Controller)")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"nslookup"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -type=srv"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," _ldap._tcp.pdc._msdcs."),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$FQDN_DOMAIN")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# find the DCs (Domain Controllers)")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"nslookup"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -type=srv"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," _ldap._tcp.dc._msdcs."),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$FQDN_DOMAIN")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# find the GC (Global Catalog, i.e. DC with extended data)")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"nslookup"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -type=srv"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," gc._msdcs."),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$FQDN_DOMAIN")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# Other ways to find services hosts that may be DCs ")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"nslookup"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -type=srv"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," _kerberos._tcp."),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$FQDN_DOMAIN")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"nslookup"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -type=srv"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," _kpasswd._tcp."),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$FQDN_DOMAIN")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"nslookup"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -type=srv"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," _ldap._tcp."),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$FQDN_DOMAIN")])])])],-1),s("p",null,"The same commands can be operated the old way with nslookup.",-1)])),_:1}),e(l,{label:"nmap"},{default:t(()=>a[1]||(a[1]=[s("p",null,[i("The "),s("a",{href:"https://nmap.org/",target:"_blank",rel:"noreferrer"},"nmap"),i(" tool can be used with its "),s("a",{href:"https://nmap.org/nsedoc/scripts/dns-srv-enum.html",target:"_blank",rel:"noreferrer"},"dns-srv-enum.nse"),i(" script to operate those queries.")],-1),s("div",{class:"language-bash vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"nmap"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --script"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," dns-srv-enum"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --script-args"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," dns-srv-enum.domain="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$FQDN_DOMAIN")])])])],-1)])),_:1})]),_:1}),a[9]||(a[9]=p(`<p>In order to function properly, the tools need to know the domain name and which nameservers to query. That information is usually <a href="./dhcp">sent through DHCP offers</a> and stored in the <code>/etc/resolv.conf</code> or <code>/run/systemd/resolve/resolv.conf</code> file in UNIX-like systems.</p><p>If needed, the nameservers may be found with a port scan on the network by looking for DNS ports <code>53/TCP</code> and <code>53/UDP</code>.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nmap</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -sV</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 53</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $SUBNET</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$MASK</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nmap</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -sV</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -sU</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 53</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $SUBNET</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$MASK</span></span></code></pre></div><div class="tip custom-block"><p>The DNS service is usually offered by the domain controllers</p></div><p><a href="https://petri.com/active_directory_srv_records" target="_blank" rel="noreferrer">https://petri.com/active_directory_srv_records</a></p><h2 id="reverse-lookups" tabindex="-1">Reverse lookups <a class="header-anchor" href="#reverse-lookups" aria-label="Permalink to &quot;Reverse lookups&quot;">​</a></h2><p>In Active Directory Integrated DNS, reverse lookup zones are used to resolve IP addresses to hostnames. This operation relies on DNS PTR records. This allows to find the names of the hosts in a network. The presence of reverse lookup zones is not mandatory in Active Directory, hence limiting reverse lookup capabilities.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># standard lookup</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">host</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $hostname</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># reverse lookup</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">host</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $IP_address</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># manual PTR resolution request</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nslookup</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -type=ptr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $IP_address</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># PTR restolution on a range</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dnsrecon</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $RANGE </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-n</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $DC_IP</span></span></code></pre></div><h2 id="dump-dns-records-in-a-domain" tabindex="-1">Dump DNS Records in a Domain <a class="header-anchor" href="#dump-dns-records-in-a-domain" aria-label="Permalink to &quot;Dump DNS Records in a Domain&quot;">​</a></h2><p>By default any user in Active Directory can enumerate all DNS records in the Domain or Forest DNS zones, similarly to a zone transfer.</p>`,10)),e(n,null,{default:t(()=>[e(l,{label:"adidnsdump"},{default:t(()=>a[2]||(a[2]=[s("p",null,[s("a",{href:"https://github.com/dirkjanm/adidnsdump",target:"_blank",rel:"noreferrer"},"adidnsdump"),i(" can be used for that purpose.")],-1),s("div",{class:"language-bash vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"adidnsdump"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -u"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," <"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"DOMAIN_FQD"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"N"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"\\\\"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"USERNAM"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"E"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," ldap://"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"DC_I"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"P"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -r")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"cat"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," records.csv")])])])],-1)])),_:1}),e(l,{label:"bloodyad"},{default:t(()=>a[3]||(a[3]=[s("p",null,[i("Alternatively, it can be achieved using "),s("a",{href:"https://github.com/CravateRouge/bloodyAD",target:"_blank",rel:"noreferrer"},"bloodyad"),i(".")],-1),s("div",{class:"language-bash vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"bloodyAD"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --host"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$DC_IP"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -d"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$DOMAIN"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -u"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$USER"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -p"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$PASSWORD"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," get"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," dnsDump")])])])],-1)])),_:1}),e(l,{label:"netexec"},{default:t(()=>a[4]||(a[4]=[s("p",null,[i("netexec's "),s("a",{href:"https://www.infosecmatter.com/crackmapexec-module-library/?cmem=smb-enum_dns",target:"_blank",rel:"noreferrer"},"Enum_dns"),i(" module utilizes WMI to dump DNS information from an Active Directory DNS Server. It extracts "),s("code",null,"MicrosoftDNS_ResourceRecord"),i(" (complete zone information) from all found domains.")],-1),s("div",{class:"language-bash vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"netexec"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," smb"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -u"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," <"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"USERNAM"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"E"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -p"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," <"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"PASSWOR"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"D"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -d"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," <"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"DOMAI"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"N"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -M"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," enum_dns")])])])],-1),s("div",{class:"tip custom-block"},[s("p",null,"So far this module only works with Administrative privileges.")],-1)])),_:1}),e(l,{label:"dig"},{default:t(()=>a[5]||(a[5]=[s("p",null,[i("If zone transfers are allowed, "),s("code",null,"dig"),i(" can be used to request a zone transfer.")],-1),s("div",{class:"language-bash vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"dig"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," axfr"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," @"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"DC_I"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"P"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," <"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"DOMAIN_FQD"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"N"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">")])])])],-1)])),_:1})]),_:1})])}const b=k(o,[["render",F]]);export{m as __pageData,b as default};
