import{_ as o,c,a5 as r,G as a,w as s,j as e,a as i,B as h,o as d}from"./chunks/framework.B5CpDqM0.js";const f=JSON.parse('{"title":"Unsigned endpoints","description":"","frontmatter":{"authors":"BlWasp, ShutdownRepo, sckdev"},"headers":[],"relativePath":"ad/movement/adcs/unsigned-endpoints.md","filePath":"ad/movement/adcs/unsigned-endpoints.md","lastUpdated":1724982529000}'),p={name:"ad/movement/adcs/unsigned-endpoints.md"};function k(u,t,g,m,y,F){const n=h("PluginTabsTab"),l=h("PluginTabs");return d(),c("div",null,[t[4]||(t[4]=r('<h1 id="unsigned-endpoints" tabindex="-1">Unsigned endpoints <a class="header-anchor" href="#unsigned-endpoints" aria-label="Permalink to &quot;Unsigned endpoints&quot;">â€‹</a></h1><h2 id="theory" tabindex="-1">Theory <a class="header-anchor" href="#theory" aria-label="Permalink to &quot;Theory&quot;">â€‹</a></h2><p>In <a href="https://posts.specterops.io/certified-pre-owned-d95910965cd2" target="_blank" rel="noreferrer">their research papers</a>, <a href="https://twitter.com/harmj0y" target="_blank" rel="noreferrer">Will Schroeder</a> and <a href="https://twitter.com/tifkin_" target="_blank" rel="noreferrer">Lee Christensen</a> found a domain escalation vector based on web endpoints vulnerable to <a href="./../ntlm/relay">NTLM relay attacks</a>. The escalation vector was dubbed <a href="https://posts.specterops.io/certified-pre-owned-d95910965cd2#48bd" target="_blank" rel="noreferrer">ESC8</a>.</p><blockquote><p>AD CS supports several HTTP-based enrollment methods via additional server roles that administrators can optionally install [(The certificate enrollment web interface, Certificate Enrollment Service (CES), Network Device Enrollment Service (NDES)).]</p><p>[...]</p><p>These HTTP-based certificate enrollment interfaces are all vulnerable to NTLM relay attacks. Using NTLM relay, an attacker can impersonate an inbound-NTLM-authenticating victim user. While impersonating the victim user, an attacker could access these web interfaces and request a client authentication certificate based on the &quot;User&quot; or &quot;Machine&quot; certificate templates.</p><p>(<a href="https://posts.specterops.io/certified-pre-owned-d95910965cd2#5c3c" target="_blank" rel="noreferrer">specterops.io</a>)</p></blockquote><p>Following this, <a href="https://twitter.com/sploutchy" target="_blank" rel="noreferrer">Sylvain Heiniger</a> from Compass Security has found a similar vulnerability on the AD CS RPC enrollment endpoint. As described in <a href="https://blog.compass-security.com/2022/11/relaying-to-ad-certificate-services-over-rpc/" target="_blank" rel="noreferrer">his article</a>, each RPC interface checks the NTLM signature independently.</p><p>For certificate request purposes, the <code>MS-ICPR</code> (ICertPassage Remote Protocol) RPC interface is used. According to the <a href="https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-icpr/0c6f150e-3ead-4006-b37f-ebbf9e2cf2e7" target="_blank" rel="noreferrer">Microsoft documentation</a>, packet privacy is enabled if the <code>IF_ENFORCEENCRYPTICERTREQUEST</code> flag is set (default configuration), meaning that NTLM relay attacks are not possible.</p><p>These attacks, like all <a href="./../ntlm/relay">NTLM relay attacks</a>, require a victim account to authenticate to an attacker-controlled machine. An attacker can coerce authentication by many means, see <a href="./../mitm-and-coerced-authentications/">MITM and coerced authentication coercion techniques</a>. Once the incoming authentication is received by the attacker, it can be relayed to an AD CS web endpoint.</p><p>Once the relayed session is obtained, the attacker poses as the relayed account and can request a client authentication certificate. The certificate template used needs to be configured for authentication (i.e. EKUs like Client Authentication, PKINIT Client Authentication, Smart Card Logon, Any Purpose (<code>OID 2.5.29.37.0</code>), or no EKU (<code>SubCA</code>)) and allowing low-priv users to enroll can be abused to authenticate as any other user/machine/admin.</p><div class="success custom-block"><p>The default User and Machine/Computer templates match those criteria and are very often enabled.</p></div><p>This allows for lateral movement, account persistence, and in some cases privilege escalation if the relayed user had powerful privileges (e.g., domain controllers or Exchange servers, domain admins etc.).</p><h2 id="practice" tabindex="-1">Practice <a class="header-anchor" href="#practice" aria-label="Permalink to &quot;Practice&quot;">â€‹</a></h2><h3 id="web-endpoint-esc8" tabindex="-1">Web endpoint (ESC8) <a class="header-anchor" href="#web-endpoint-esc8" aria-label="Permalink to &quot;Web endpoint (ESC8)&quot;">â€‹</a></h3>',12)),a(l,null,{default:s(()=>[a(n,{label:"UNIX-like"},{default:s(()=>t[0]||(t[0]=[e("p",null,[e("strong",null,"1. Relay servers setup ðŸ§°")],-1),e("p",null,[i("From UNIX-like systems, "),e("a",{href:"https://github.com/SecureAuthCorp/impacket",target:"_blank",rel:"noreferrer"},"Impacket"),i("'s "),e("a",{href:"https://github.com/SecureAuthCorp/impacket/blob/master/examples/ntlmrelayx.py",target:"_blank",rel:"noreferrer"},"ntlmrelayx"),i(" (Python) can be used to conduct the ESC8 escalation scenario.")],-1),e("div",{class:"language-bash vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"bash"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[e("code",null,[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"ntlmrelayx"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -t"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," http://"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$PKI"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},".domain.local/certsrv/certfnsh.asp"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --adcs"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --template"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "Template name"')])])])],-1),e("div",{class:"tip custom-block"},[e("p",null,[i("The certificate template flag (i.e. "),e("code",null,"--template"),i(") can either be left blank (defaults to Machine or User whether relayed account name ends with "),e("code",null,"$"),i(") or chosen among the certificate templates that fill the requirements.")]),e("p",null,[i("For instance, if the relayed principal is a domain controller, the "),e("code",null,"DomainController"),i(" template must be specified.")])],-1),e("p",null,[e("a",{href:"https://github.com/ly4k/Certipy",target:"_blank",rel:"noreferrer"},"Certipy"),i(" (Python) can be used to enumerate information regarding the certificate templates (EKUs allowing for authentication, allowing low-priv users to enroll, etc.) and identify enabled HTTP endpoint ("),e("a",{href:"./#attack-paths"},"how to enumerate"),i(").")],-1),e("div",{class:"language-bash vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"bash"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[e("code",null,[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# find ESC8-vulnerable CAs")]),i(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"certipy"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," find"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -u"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$USER"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"@"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$DOMAIN"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -p"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$PASSWORD"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -dc-ip"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$DC_IP"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -stdout"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," |"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," grep"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -B20"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," ESC8")]),i(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# find and look through enabled templates for ones that could be used for authentication")]),i(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"certipy"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," find"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -u"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$USER"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"@"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$DOMAIN"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -p"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$PASSWORD"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -dc-ip"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$DC_IP"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -stdout"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -enabled")])])])],-1),e("div",{class:"tip custom-block"},[e("p",null,[i("By default, Certipy uses LDAPS, which is not always supported by the domain controllers. The "),e("code",null,"-scheme"),i(" flag can be used to set whether to use LDAP or LDAPS.")])],-1),e("hr",null,null,-1),e("p",null,[e("strong",null,"2. Authentication coercion â›“ï¸")],-1),e("p",null,[i("Just like any other NTLM relay attack, once the relay servers are running and waiting for incoming NTLM authentications, authentication coercion techniques can be used (e.g. "),e("a",{href:"./../mitm-and-coerced-authentications/ms-rprn"},"PrinterBug"),i(", "),e("a",{href:"./../mitm-and-coerced-authentications/ms-efsr"},"PetitPotam"),i(", "),e("a",{href:"./../exchange-services/privexchange"},"PrivExchange"),i(") to force accounts/machines to authenticate to the relay servers.")],-1),e("div",{class:"tip custom-block"},[e("p",null,[i("Read the "),e("a",{href:"./../mitm-and-coerced-authentications/"},"mitm-and-coerced-authentications"),i(" article for more insight.")])],-1),e("hr",null,null,-1),e("p",null,[e("strong",null,"3. Loot ðŸŽ‰")],-1),e("p",null,[i("Once incoming NTLM authentications are relayed and authenticated sessions abused, base64-encoded PFX certificates will be obtained and usable with "),e("a",{href:"./../kerberos/pass-the-certificate"},"Pass-the-Certificate"),i(" to obtain a TGT and authenticate.")],-1)])),_:1}),a(n,{label:"Windows"},{default:s(()=>t[1]||(t[1]=[e("p",null,[i("From Windows systems, the "),e("a",{href:"https://github.com/GhostPack/Certify",target:"_blank",rel:"noreferrer"},"Certify"),i(" (C#) tool can be used to enumerate enabled web endpoints (both HTTP and HTTPS).")],-1),e("div",{class:"language-batch vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"batch"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[e("code",null,[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"Certify.exe cas")])])])],-1),e("div",{class:"warning custom-block"},[e("p",null,"If web endpoints are enabled, switch to UNIX because at the time of writing (October 20th, 2021), I don't know how to easily conduct the ESC8 abuse from Windows.")],-1)])),_:1})]),_:1}),t[5]||(t[5]=e("h3",{id:"rpc-endpoint-esc11",tabindex:"-1"},[i("RPC endpoint (ESC11) "),e("a",{class:"header-anchor",href:"#rpc-endpoint-esc11","aria-label":'Permalink to "RPC endpoint (ESC11)"'},"â€‹")],-1)),a(l,null,{default:s(()=>[a(n,{label:"UNIX-like"},{default:s(()=>t[2]||(t[2]=[e("p",null,[e("strong",null,"1. Relay servers setup ðŸ§°")],-1),e("p",null,[i("From UNIX-like systems, "),e("a",{href:"https://github.com/SecureAuthCorp/impacket",target:"_blank",rel:"noreferrer"},"Impacket"),i("'s "),e("a",{href:"https://github.com/SecureAuthCorp/impacket/blob/master/examples/ntlmrelayx.py",target:"_blank",rel:"noreferrer"},"ntlmrelayx"),i(" (Python) can be used to conduct the ESC11 escalation scenario.")],-1),e("div",{class:"language-bash vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"bash"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[e("code",null,[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"ntlmrelayx"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -t"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," rpc://"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$PKI"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},".domain.local"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -rpc-mode"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," ICPR"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -icpr-ca-name"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $CA_NAME "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-smb2support"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --template"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "Template name"')])])])],-1),e("div",{class:"tip custom-block"},[e("p",null,[i("The certificate template flag (i.e. "),e("code",null,"--template"),i(") can either be left blank (defaults to Machine or User whether relayed account name ends with "),e("code",null,"$"),i(") or chosen among the certificate templates that fill the requirements.")]),e("p",null,[i("For instance, if the relayed principal is a domain controller, the "),e("code",null,"DomainController"),i(" template must be specified.")])],-1),e("p",null,[e("a",{href:"https://github.com/ly4k/Certipy",target:"_blank",rel:"noreferrer"},"Certipy"),i(" (Python) can be used to enumerate information regarding the certificate templates (EKUs allowing for authentication, allowing low-priv users to enroll, etc.) and identify a vulnerable RPC endpoint ("),e("a",{href:"./#attack-paths"},"how to enumerate"),i(").")],-1),e("div",{class:"language-bash vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"bash"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[e("code",null,[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# find ESC11-vulnerable CAs")]),i(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"certipy"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," find"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -u"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$USER"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"@"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$DOMAIN"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -p"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$PASSWORD"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -dc-ip"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$DC_IP"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -stdout"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," |"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," grep"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -B20"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," ESC11")]),i(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# find and look through enabled templates for ones that could be used for authentication")]),i(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"certipy"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," find"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -u"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$USER"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"@"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$DOMAIN"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -p"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$PASSWORD"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -dc-ip"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$DC_IP"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -stdout"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -enabled")])])])],-1),e("div",{class:"tip custom-block"},[e("p",null,[i("By default, Certipy uses LDAPS, which is not always supported by the domain controllers. The "),e("code",null,"-scheme"),i(" flag can be used to set whether to use LDAP or LDAPS.")])],-1),e("hr",null,null,-1),e("p",null,[e("strong",null,"2. Authentication coercion â›“ï¸")],-1),e("p",null,[i("Just like any other NTLM relay attack, once the relay servers are running and waiting for incoming NTLM authentications, authentication coercion techniques can be used (e.g. "),e("a",{href:"./../mitm-and-coerced-authentications/ms-rprn"},"PrinterBug"),i(", "),e("a",{href:"./../mitm-and-coerced-authentications/ms-efsr"},"PetitPotam"),i(", "),e("a",{href:"./../exchange-services/privexchange"},"PrivExchange"),i(") to force accounts/machines to authenticate to the relay servers.")],-1),e("div",{class:"tip custom-block"},[e("p",null,[i("Read the "),e("a",{href:"./../mitm-and-coerced-authentications/"},"mitm-and-coerced-authentications"),i(" article for more insight.")])],-1),e("hr",null,null,-1),e("p",null,[e("strong",null,"3. Loot ðŸŽ‰")],-1),e("p",null,[i("Once incoming NTLM authentications are relayed and authenticated sessions abused, base64-encoded PFX certificates will be obtained and usable with "),e("a",{href:"./../kerberos/pass-the-certificate"},"Pass-the-Certificate"),i(" to obtain a TGT and authenticate.")],-1)])),_:1}),a(n,{label:"Windows"},{default:s(()=>t[3]||(t[3]=[e("p",null,[e("em",null,"From Windows systems, at the time of writing (April 24th, 2024) no tool permits to identify and exploit the ESC11 vulnerability. Look at the UNIX-like tab to perform the exploitation.")],-1)])),_:1})]),_:1}),t[6]||(t[6]=r('<h2 id="resources" tabindex="-1">Resources <a class="header-anchor" href="#resources" aria-label="Permalink to &quot;Resources&quot;">â€‹</a></h2><p><a href="https://www.exandroid.dev/2021/06/23/ad-cs-relay-attack-practical-guide" target="_blank" rel="noreferrer">https://www.exandroid.dev/2021/06/23/ad-cs-relay-attack-practical-guide</a></p><p><a href="https://dirkjanm.io/ntlm-relaying-to-ad-certificate-services" target="_blank" rel="noreferrer">https://dirkjanm.io/ntlm-relaying-to-ad-certificate-services</a></p><p><a href="https://posts.specterops.io/certified-pre-owned-d95910965cd2" target="_blank" rel="noreferrer">https://posts.specterops.io/certified-pre-owned-d95910965cd2</a></p><p><a href="https://blog.compass-security.com/2022/11/relaying-to-ad-certificate-services-over-rpc/" target="_blank" rel="noreferrer">https://blog.compass-security.com/2022/11/relaying-to-ad-certificate-services-over-rpc/</a></p>',5))])}const C=o(p,[["render",k]]);export{f as __pageData,C as default};
