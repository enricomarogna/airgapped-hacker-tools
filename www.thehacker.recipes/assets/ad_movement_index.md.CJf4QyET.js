import{_ as a,c as t,a5 as i,o as r}from"./chunks/framework.B5CpDqM0.js";const p=JSON.parse('{"title":"Movement","description":"","frontmatter":{"authors":"BlWasp, ShutdownRepo, itbelongsinamuseum, sckdev"},"headers":[],"relativePath":"ad/movement/index.md","filePath":"ad/movement/index.md","lastUpdated":1724982529000}'),n={name:"ad/movement/index.md"};function o(s,e,c,l,d,h){return r(),t("div",null,e[0]||(e[0]=[i('<h1 id="movement" tabindex="-1">Movement <a class="header-anchor" href="#movement" aria-label="Permalink to &quot;Movement&quot;">â€‹</a></h1><div class="warning custom-block"><p>This is a work-in-progress</p></div><p>Below is a checklist to go through when conducting a pentest. Order is irrelevant and many tests require authenticated or admin access. This checklist answers &quot;what to audit on AD?&quot; rather than &quot;how to pwn AD?&quot;. A mindmap is in the works for that matter ðŸ˜‰ .</p><h3 id="ntlm-configuration" tabindex="-1">NTLM configuration <a class="header-anchor" href="#ntlm-configuration" aria-label="Permalink to &quot;NTLM configuration&quot;">â€‹</a></h3><ul><li>[ ] Obsolete versions of this protocol (LM, LMv2 and NTLM(v1)) are disabled and NTLM (all versions) is disabled when possible. This allows to stay safe from <a href="./ntlm/relay">NTLM relay</a>, <a href="./ntlm/capture">NTLM capture</a> and <a href="./credentials/cracking#tips-and-tricks">cracking</a> and <a href="./ntlm/pth">pass-the-hash</a> attacks.</li></ul><h3 id="kerberos-configuration" tabindex="-1">Kerberos configuration <a class="header-anchor" href="#kerberos-configuration" aria-label="Permalink to &quot;Kerberos configuration&quot;">â€‹</a></h3><ul><li>[ ] <code>krbtgt</code>&#39;s password has been changed in the last 6 months to prevent <a href="./../persistence/kerberos/forged-tickets">Golden Ticket</a> persistence attacks. From UNIX-like systems, this can be checked with <a href="https://github.com/SecureAuthCorp/impacket/" target="_blank" rel="noreferrer">Impacket</a>&#39;s <a href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/GetADUsers.py" target="_blank" rel="noreferrer">Get-ADUsers.py</a> script.</li><li>[ ] The RC4 <code>etype</code> is disabled for Kerberos to prevent <a href="./kerberos/opth">overpass-the-hash</a> and <a href="./ntlm/capture">NTLMv1 capture</a> and <a href="./credentials/cracking#tips-and-tricks">cracking</a> to <a href="./../persistence/kerberos/forged-tickets">Silver Ticket</a> attacks. This can be checked by attempting to obtain a TGT with an NT hash.</li><li>[ ] No account is configured with <code>Do not require Kerberos Pre-Authentication</code> allowing for <a href="./kerberos/asreproast">ASREProast</a> attacks, or make sure those account have strong password resistant to <a href="./credentials/cracking">cracking</a>.</li><li>[ ] User accounts that have at least one <code>ServicePrincipalName</code>, hence vulnerable to <a href="./kerberos/kerberoast">Kerberoast</a>, have a strong password, resistant to <a href="./credentials/cracking">cracking.</a></li></ul><h3 id="patch-management" tabindex="-1">Patch management <a class="header-anchor" href="#patch-management" aria-label="Permalink to &quot;Patch management&quot;">â€‹</a></h3><ul><li>[ ] Domain Controllers are patched against <a href="./netlogon/zerologon">ZeroLogon</a>.</li><li>[ ] Domain Controllers are patched against <a href="./kerberos/samaccountname-spoofing">Kerberos sAMAccountName spoofing</a>.</li><li>[ ] <a href="./kerberos/forged-tickets/ms14-068">MS14-068</a> is patched, preventing forging of powerful Kerberos tickets.</li><li>[ ] <a href="./exchange-services/privexchange">PrivExchange</a> patches are applied, protecting Exchange servers from <a href="./mitm-and-coerced-authentications/pushsubscription-abuse">authentication coercion attacks relying on the PushSubscription API</a>, and <a href="./dacl/">ACE abuse</a> attacks relying on the <code>EXCHANGE WINDOWS PERMISSION</code> group having <code>WriteDacl</code> permissions against the domain object allowing for <a href="./credentials/dumping/dcsync">DCSync</a>.</li><li>[ ] Patches for NTLM tampering vulnerabilities (e.g. CVE-2019-1040, CVE-2019-1019, CVE-2019-1166) are applied to limit <a href="./ntlm/relay">NTLM relay</a> attacks.</li><li>[ ] Latest security patched are applied (e.g. for ProxyLogon, ProxyShell, PrintNightmare, ...).</li></ul><h3 id="access-management-iam-pam" tabindex="-1">Access Management (IAM/PAM) <a class="header-anchor" href="#access-management-iam-pam" aria-label="Permalink to &quot;Access Management (IAM/PAM)&quot;">â€‹</a></h3><ul><li>[ ] Local administrators have a unique, random, complex and rotating password on every server/workstation (e.g. use of LAPS). This can be checked by dumping a local admin password or hash and attempting <a href="./credentials/bruteforcing/stuffing">credential stuffing</a> (i.e. trying to log in on other resources with that password/hash).</li><li>[ ] Strong <a href="./../recon/password-policy">password and lockout policies</a> exist and are applied (complexity enabled, at least 12 chars, 16 for admins, must change every 6 months) and users know not to use simple and guessable passwords (e.g. password == username) limiting credential bruteforcing, <a href="./credentials/bruteforcing/guessing">guessing</a>, <a href="./credentials/bruteforcing/stuffing">stuffing</a> and <a href="./credentials/cracking">cracking</a> attacks.</li><li>[ ] Tier Model is applied (administrative personnel have multiple accounts, one for each tier, with different passwords and security requirements for each one) and a &quot;least requirement&quot; policy is followed (i.e. service accounts don&#39;t have domain admin (or equivalent) privileges, ACEs are carefully set) limiting credential bruteforcing, <a href="./credentials/bruteforcing/guessing">guessing</a>, <a href="./credentials/bruteforcing/stuffing">stuffing</a> and <a href="./credentials/cracking">cracking</a> attacks.</li><li>[ ] Sensitive network shares are not readable by all users. A &quot;need to know&quot; policy is followed, preventing data leak and other.</li><li>[ ] No account is configured with <a href="./kerberos/delegations/#unconstrained-delegations">Kerberos Unconstrained Delegation</a> capabilities.</li><li>[ ] No computer account has admin privileges over another one. This limits <a href="./ntlm/relay">NTLM relay</a> attacks.</li></ul><h3 id="credentials-management" tabindex="-1">Credentials Management <a class="header-anchor" href="#credentials-management" aria-label="Permalink to &quot;Credentials Management&quot;">â€‹</a></h3><ul><li>[ ] Caching of domain users is limited on workstations and avoided on servers to prevent <a href="./credentials/dumping/index">credential dumping</a> of LSA secrets from registry.</li><li>[ ] <a href="./credentials/dumping/group-policies-preferences">Group Policy Preferences Passwords</a> are not used.</li><li>[ ] LSA protection are enabled to prevent <a href="./credentials/dumping/lsass">LSASS dumping</a>.</li><li>[ ] Network shares readable by all domain users don&#39;t contain sensitive data like passwords or certificates limiting <a href="./credentials/dumping/network-shares">credential dumping</a>.</li></ul><h3 id="domain-level-configuration-and-best-practices" tabindex="-1">Domain-level configuration and best-practices <a class="header-anchor" href="#domain-level-configuration-and-best-practices" aria-label="Permalink to &quot;Domain-level configuration and best-practices&quot;">â€‹</a></h3><ul><li>[ ] The <a href="./builtins/machineaccountquota">Machine Account Quota</a> domain-level attribute is set to 0, preventing domain users from creating domain-joined computer accounts.</li><li>[ ] Default <a href="./builtins/security-groups">special groups</a> are empty, limiting, among other things, out-of-box ACE abuses.</li></ul><h3 id="networking-protocols-and-services" tabindex="-1">Networking, protocols and services <a class="header-anchor" href="#networking-protocols-and-services" aria-label="Permalink to &quot;Networking, protocols and services&quot;">â€‹</a></h3><ul><li>[ ] SMB signing is required when possible, especially on sensitive servers, preventing <a href="./ntlm/relay">NTLM relay</a> attacks.</li><li>[ ] LDAP signing is required on Domain Controllers, preventing <a href="./ntlm/relay">NTLM relay</a> attacks.</li><li>[ ] Extended Protection for Authentication (EPA) is required, especially for Domain Controllers supporting LDAPS, preventing <a href="./ntlm/relay">NTLM relay</a> attacks.</li><li>[ ] IPv6 is either fully configured and used or disabled, preventing <a href="./mitm-and-coerced-authentications/dhcpv6-spoofing">DHCPv6 spoofing with DNS poisoning</a> attacks.</li><li>[ ] <a href="./mitm-and-coerced-authentications/llmnr-nbtns-mdns-spoofing">LLMNR, NBT-NS and mDNS</a> are disabled, preventing MITM attacks relying on those multicast/broadcast domain name resolution protocols.</li><li>[ ] WPAD is disabled, preventing <a href="./mitm-and-coerced-authentications/wpad-spoofing">WPAD spoofing</a>.</li><li>[ ] A record exists in ADIDNS for the <code>*</code> (wildcard) preventing powerful <a href="./mitm-and-coerced-authentications/adidns-spoofing">ADIDNS poisoning</a> attacks. Preferably, this is a <code>TXT</code> record.</li><li>[ ] The print spooler is disabled on Domain Controllers and sensitive servers to prevent the <a href="./print-spooler-service/printerbug">PrinterBug</a> authentication coercion attack.</li><li>[ ] The WSUS server (if any) is configured with HTTPS, to prevent ARP poisoning with <a href="./mitm-and-coerced-authentications/wsus-spoofing">WSUS spoofing</a> attacks.</li><li>[ ] Set-up packet filtering &amp; inspection and enable port security on network switched to prevent <a href="./mitm-and-coerced-authentications/arp-poisoning">ARP poisoning</a> attacks and <a href="./credentials/dumping/network-protocols">network secrets dumping</a>.</li><li>[ ] Set-up VLANs, 802.1X or other <a href="./../../physical/networking/network-access-control">NAC (Network Access Control)</a> securities to limit the attackers progress within the network.</li><li>[ ] Plaintext protocols are avoided when using credentials (HTTP, FTP, ...), in order to minimize the risks of the <a href="./credentials/dumping/network-protocols">capture of credentials transiting on the network</a>.</li></ul><h3 id="active-directory-certificate-services" tabindex="-1">Active Directory Certificate Services <a class="header-anchor" href="#active-directory-certificate-services" aria-label="Permalink to &quot;Active Directory Certificate Services&quot;">â€‹</a></h3><ul><li>[ ] The CA is configured correctly (the <code>EDITF_ATTRIBUTESUBJECTALTNAME2</code> flag is not set). This prevents <a href="./adcs/certificate-authority">the corresponding domain escalation attack</a>.</li><li>[ ] There are no certificate templates that are badly configured. This prevents <a href="./adcs/certificate-templates">the corresponding domain escalation attack</a>.</li><li>[ ] AD-CS web and RPC endpoints are secured against <a href="./adcs/unsigned-endpoints">AD-CS NTLM relay attacks</a> (HTTPS, EPA (Extended Protection for Authentication) and encryption enforced).</li></ul>',19)]))}const g=a(n,[["render",o]]);export{p as __pageData,g as default};
