import{_ as s,c as t,a5 as e,o as i}from"./chunks/framework.B5CpDqM0.js";const k=JSON.parse('{"title":"Cracking","description":"MITRE ATT&CK™ Sub-technique T1110.002","frontmatter":{"description":"MITRE ATT&CK™ Sub-technique T1110.002","authors":"ShutdownRepo"},"headers":[],"relativePath":"ad/movement/credentials/cracking.md","filePath":"ad/movement/credentials/cracking.md","lastUpdated":1724982529000}'),r={name:"ad/movement/credentials/cracking.md"};function h(n,a,l,o,p,c){return i(),t("div",null,a[0]||(a[0]=[e(`<h1 id="cracking" tabindex="-1">Cracking <a class="header-anchor" href="#cracking" aria-label="Permalink to &quot;Cracking&quot;">​</a></h1><h2 id="theory" tabindex="-1">Theory <a class="header-anchor" href="#theory" aria-label="Permalink to &quot;Theory&quot;">​</a></h2><p>Attacking Active Directory domains often leads to obtaining password interesting, but either hashed or encrypted data. When this information cannot be directly leveraged for higher privileges (like with <a href="./../ntlm/pth">pass-the-hash</a>, <a href="./../kerberos/ptk">overpass-the-hash</a>), it is required to crack it.</p><p>Cracking is an operation that can be carried out through different types of attacks:</p><ul><li>Brute-force: every possibility for a given character set and a given length (i.e. <code>aaa</code>, <code>aab</code>, <code>aac</code>, ...) is hashed and compared against the target hash.</li><li>Dictionary: every word of a given list (a.k.a. dictionary) is hashed and compared against the target hash.</li><li>Rainbow tables: the hash is looked for in a pre-computed table. It is a <a href="https://en.wikipedia.org/wiki/Space%E2%80%93time_tradeoff" target="_blank" rel="noreferrer">time-memory trade-off</a> that allows cracking hashes faster, but costing a greater amount of memory than traditional brute-force of dictionary attacks. This attack cannot work if the hashed value is salted (i.e. hashed with an additional random value as prefix/suffix, making the pre-computed table irrelevant)</li></ul><p>There are many other and more complex types of attacks (incremental, mask, rules, hybrid types, ...) but the major/core ones are the three above.</p><h2 id="practice" tabindex="-1">Practice <a class="header-anchor" href="#practice" aria-label="Permalink to &quot;Practice&quot;">​</a></h2><p>One of the greatest tools that can be used for cracking is <a href="https://hashcat.net/hashcat/" target="_blank" rel="noreferrer">hashcat</a> (C). It implements different types of attacks and many types of hashes. It has many other great features like</p><ul><li>it is cross-platform (support for Linux, Windows and macOS) and supports anything that comes with an OpenCL runtime (CPU, GPU, APU, ...)</li><li>it can crack multiple hashes at the same time and use multiple devices at once (distributed cracking networks supported too)</li><li>it can save and restore sessions</li><li>it has a builtin benchmarking system</li></ul><p>Below is a short list of the most useful hash types for Active Directory hunting.</p><table tabindex="0"><thead><tr><th>Hash type</th><th><code>-m/--hash-type</code> number</th></tr></thead><tbody><tr><td>LM hash</td><td>3000</td></tr><tr><td>NT hash</td><td>1000</td></tr><tr><td><a href="./../ntlm/capture">LM response</a></td><td><a href="https://github.com/hashcat/hashcat/issues/78#issuecomment-276048841" target="_blank" rel="noreferrer">not supported</a></td></tr><tr><td><a href="./../ntlm/capture">LMv2 response</a></td><td><a href="https://github.com/hashcat/hashcat/issues/78#issuecomment-276048841" target="_blank" rel="noreferrer">not supported</a></td></tr><tr><td><a href="./../ntlm/capture">NTLM response</a></td><td>5500</td></tr><tr><td><a href="./../ntlm/capture">NTLMv2 response</a></td><td>5600</td></tr><tr><td><a href="./dumping/sam-and-lsa-secrets">(DCC1) Domain Cached Credentials</a></td><td>1100</td></tr><tr><td><a href="./dumping/sam-and-lsa-secrets">(DCC2) Domain Cached Credentials 2</a></td><td>2100</td></tr><tr><td><a href="./../kerberos/asreqroast">ASREQroast</a></td><td>7500</td></tr><tr><td><a href="./../kerberos/asreproast">ASREProast</a></td><td>18200</td></tr><tr><td><a href="./../kerberos/kerberoast">Kerberoast</a></td><td>13100</td></tr></tbody></table><h3 id="dictionnary-attack" tabindex="-1">Dictionnary attack <a class="header-anchor" href="#dictionnary-attack" aria-label="Permalink to &quot;Dictionnary attack&quot;">​</a></h3><p>Below is an example of how to use hashcat for a dictionary attack.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hashcat</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --attack-mode</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --hash-type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $number $hashes_file $wordlist_file</span></span></code></pre></div><h3 id="dictionary-and-rules-attack" tabindex="-1">Dictionary and rules attack <a class="header-anchor" href="#dictionary-and-rules-attack" aria-label="Permalink to &quot;Dictionary and rules attack&quot;">​</a></h3><div class="tip custom-block"><p>Hashcat has the ability to inject the plain passwords cracked into the dictionary and start the attack again, and this recursively until no new passwords are found. This can be done with the <code>--loopback</code> argument.</p><p><em>Nota bene: the new passwords are added to dictionnary caches that will be temporary and deleted after the bruteforce+rules+loopack attack ends.</em></p></div><p>Hashcat can also be used in a hybrid mode by combining a dictionary attack with rules that will operate transformations to the words of the list.</p><ul><li>Great wordlists: <a href="https://weakpass.com/" target="_blank" rel="noreferrer">weakpass</a>, <a href="https://packetstormsecurity.com/Crackers/wordlists/" target="_blank" rel="noreferrer">packetstorm</a></li><li>Great rules: <a href="https://github.com/rarecoil/pantagrule" target="_blank" rel="noreferrer">pantagrule</a>, <a href="https://notsosecure.com/one-rule-to-rule-them-all/" target="_blank" rel="noreferrer">OneRuleToRuleThemAll</a></li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hashcat</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --loopback</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --attack-mode</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --rules-file</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $rules_file </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">--hash-type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $number $hashes_file $wordlist_file</span></span></code></pre></div><h3 id="brute-force-attack" tabindex="-1">Brute-force attack <a class="header-anchor" href="#brute-force-attack" aria-label="Permalink to &quot;Brute-force attack&quot;">​</a></h3><div class="success custom-block"><p class="custom-block-title">TL; DR - 8 chars bruteforce</p><p>Below is a hashcat command that bruteforces any password from 4 to 8 characters long. Each character can be any printable character.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hashcat</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --attack-mode</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --increment</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --increment-min</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --increment-max</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 8</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --hash-type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $number $hashes_file </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;?a?a?a?a?a?a?a?a?a?a?a?a&quot;</span></span></code></pre></div></div><p>Hashcat has the following built-in charsets that can be used.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>?l = abcdefghijklmnopqrstuvwxyz</span></span>
<span class="line"><span>?u = ABCDEFGHIJKLMNOPQRSTUVWXYZ</span></span>
<span class="line"><span>?d = 0123456789</span></span>
<span class="line"><span>?s = !&quot;#$%&amp;&#39;()*+,-./:;&lt;=&gt;?@[\\]^_\`{|}~</span></span>
<span class="line"><span>?a = ?l?u?d?s</span></span>
<span class="line"><span>?b = 0x00 - 0xff</span></span></code></pre></div><p>Below are examples of hashcat being used with built-in charset.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Passwords are like : 1 capital letter, 3 letters, 4 numbers, 1 special char</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hashcat</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --attack-mode</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --hash-type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $number $hashes_file </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;?u?l?l?l?d?d?d?d?s&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Password are 8 chars-long and can be any printable char.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hashcat</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --attack-mode</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --hash-type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $number $hashes_file </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;?a?a?a?a?a?a?a?a&quot;</span></span></code></pre></div><p>Hashcat can also be started with custom charsets in the following manner.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hashcat</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --attack-mode</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --custom-charset1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;?u&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --custom-charset2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;?l?u?d&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --custom-charset3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;?d&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --hash-type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $number $hashes_file </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;?1?2?2?2?3&quot;</span></span></code></pre></div><p>Hashcat also has an incremental feature that allows to bruteforce passwords up to a certain length whereas the commands above only try the specified mask&#39;s length.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Password are up to 8 chars-long and can be any printable char.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hashcat</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --attack-mode</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --increment</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --hash-type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $number $hashes_file </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;?a?a?a?a?a?a?a?a&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Password are 4 to 8 chars-long and can be any printable char (mask length is 12 so that --increment-max can be upped to 12).</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hashcat</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --attack-mode</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --increment</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --increment-min</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --increment-max</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 8</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --hash-type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $number $hashes_file </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;?a?a?a?a?a?a?a?a?a?a?a?a&quot;</span></span></code></pre></div><p>More information on how to fully use hashcat can be found <a href="https://www.4armed.com/blog/perform-mask-attack-hashcat/" target="_blank" rel="noreferrer">here</a>.</p><h3 id="hashcat-alternative" tabindex="-1">Hashcat alternative <a class="header-anchor" href="#hashcat-alternative" aria-label="Permalink to &quot;Hashcat alternative&quot;">​</a></h3><p>A robust alternative to hashcat is <a href="https://github.com/openwall/john" target="_blank" rel="noreferrer">John the Ripper</a>, a.k.a. john (C). It handles some hash types that hashcat doesn&#39;t (Domain Cached Credentials for instance) but it also has a strong community that regularly releases tools in the form of &quot;something2john&quot; that convert things to a john crackable format (e.g. <code>bitlocker2john</code>, <code>1password2john</code>, <code>keepass2john</code>, <code>lastpass2john</code> and so on).</p><h2 id="tips-tricks" tabindex="-1">Tips &amp; tricks <a class="header-anchor" href="#tips-tricks" aria-label="Permalink to &quot;Tips &amp; tricks&quot;">​</a></h2><div class="tip custom-block"><p></p><ul><li>Google offers services like <a href="https://colab.research.google.com/" target="_blank" rel="noreferrer">Colab</a> and <a href="https://console.cloud.google.com/home/dashboard?cloudshell=true" target="_blank" rel="noreferrer">Cloud Shell</a> that can be used for &quot;cloud cracking&quot;. There are projects like <a href="https://github.com/mxrch/penglab" target="_blank" rel="noreferrer">penglab</a>, <a href="https://github.com/ShutdownRepo/google-colab-hashcat" target="_blank" rel="noreferrer">google-colab-hashcat</a> and <a href="https://github.com/JoelGMSec/Cloudtopolis" target="_blank" rel="noreferrer">cloudtopolis</a> that can help testers to setup a cracking session on such resources</li><li>Other solutions, cloud-based or not, can be used to improve cracking speed: <a href="https://www.netmux.com/blog/how-to-build-a-password-cracking-rig" target="_blank" rel="noreferrer">setting up a rig</a> for instance.</li><li>LM and NTLM ChallengeResponses can be cracked really fast (and for free depending on the hash) on <a href="https://crack.sh/get-cracking/" target="_blank" rel="noreferrer">crack.sh</a>, a remote service that cracks the hash with rainbow tables (<a href="./../ntlm/capture#practice">here&#39;s how to capture those hashes</a>).</li><li>Testers that manage to pwn a domain admin or a distributed local admin should try to operate multiple <a href="./dumping/lsass">LSASS dumps</a> to create a custom wordlist for a dictionary attack</li><li>Cracking LM and NT hash can be optimized by following <a href="https://blog.didierstevens.com/2016/07/25/practice-ntds-dit-file-overview/" target="_blank" rel="noreferrer">these advice</a>.</li></ul><p>See <a href="https://hashcat.net/wiki/doku.php?id=example_hashes" target="_blank" rel="noreferrer">hashcat.net</a></p></div>`,34)]))}const u=s(r,[["render",h]]);export{k as __pageData,u as default};
