import{_ as t,c as a,a5 as i,o as s}from"./chunks/framework.B5CpDqM0.js";const k=JSON.parse('{"title":"Bronze Bit","description":"CVE-2020-17049","frontmatter":{"description":"CVE-2020-17049","authors":"ShutdownRepo"},"headers":[],"relativePath":"ad/movement/kerberos/delegations/bronze-bit.md","filePath":"ad/movement/kerberos/delegations/bronze-bit.md","lastUpdated":1724982529000}'),r={name:"ad/movement/kerberos/delegations/bronze-bit.md"};function o(n,e,h,l,d,p){return s(),a("div",null,e[0]||(e[0]=[i('<h1 id="bronze-bit" tabindex="-1">Bronze Bit <a class="header-anchor" href="#bronze-bit" aria-label="Permalink to &quot;Bronze Bit&quot;">​</a></h1><h2 id="theory" tabindex="-1">Theory <a class="header-anchor" href="#theory" aria-label="Permalink to &quot;Theory&quot;">​</a></h2><p>When abusing Kerberos delegations, S4U extensions usually come into play. One of those extensions is S4U2proxy. <a href="./constrained">Constrained</a> and <a href="./rbcd">Resource-Based Constrained</a> delegations rely on that extensions. A requirement to be able to use S4U2proxy is to use an additional service ticket as evidence (usually issued by after S4U2self request). That ticket needs to have the <code>forwardable</code> flag set. There are a few reasons why that flag wouldn&#39;t be set on a ticket</p><ul><li>the &quot;impersonated&quot; user was member of the &quot;Protected Users&quot; group or was configured as &quot;sensitive for delegation&quot;</li><li>the service account configured for <a href="./constrained">constrained delegation</a> was configured for <a href="./constrained#without-protocol-transition">Kerberos only/without protocol transition</a></li></ul><p>In 2020, the &quot;bronze bit&quot; (CVE-2020-17049) was released, allowing attackers to edit a ticket and set the <code>forwardable</code> flag.</p><h2 id="practice" tabindex="-1">Practice <a class="header-anchor" href="#practice" aria-label="Permalink to &quot;Practice&quot;">​</a></h2><p>The <a href="https://github.com/SecureAuthCorp/impacket" target="_blank" rel="noreferrer">Impacket</a> script <a href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/getST.py" target="_blank" rel="noreferrer">getST</a> (Python) can perform all the necessary steps to edit a ticket&#39;s flags and obtain a ticket through S4U2proxy to act as another user on a target service (in this case, &quot;Administrator&quot; is impersonated/delegated account but it can be any user in the environment).</p><p>The input credentials are those of the compromised service account configured for constrained delegations.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getST.py</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -force-forwardable</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -spn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$Target_SPN</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -impersonate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Administrator&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -dc-ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$DC_HOST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -hashes</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$NT_HASH</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$DOMAIN</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$USER</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span></code></pre></div><p>The SPN (ServicePrincipalName) set will have an impact on what services will be reachable. For instance, <code>cifs/target.domain</code> or <code>host/target.domain</code> will allow most remote dumping operations (more info on <a href="https://adsecurity.org/?page_id=183" target="_blank" rel="noreferrer">adsecurity.org</a>).</p><h2 id="resources" tabindex="-1">Resources <a class="header-anchor" href="#resources" aria-label="Permalink to &quot;Resources&quot;">​</a></h2><p><a href="https://www.netspi.com/blog/technical/network-penetration-testing/cve-2020-17049-kerberos-bronze-bit-overview" target="_blank" rel="noreferrer">https://www.netspi.com/blog/technical/network-penetration-testing/cve-2020-17049-kerberos-bronze-bit-overview</a></p>',12)]))}const u=t(r,[["render",o]]);export{k as __pageData,u as default};
