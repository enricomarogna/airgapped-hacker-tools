<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Eventvwr | LOLBAS</title>
    <link rel="icon" href="/assets/favicon.png">
    <link rel="stylesheet" href="/assets/style.css" type="text/css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <script async src="/assets/mitre_attack.js"></script><meta name="title" content="Eventvwr on LOLBAS">
    <meta name="description" content="Eventvwr.exe is a living-of-the-land file containing unexpected functionality that can be abused by attackers; this page lists all its use cases.">
    <meta property="og:title" name="og:title" content="Eventvwr on LOLBAS">
    <meta property="og:site_name" name="og:site_name" content="LOLBAS">
    <meta property="og:type" name="og:type" content="object">
    <meta property="og:url" name="og:url" content="/lolbas/Binaries/Eventvwr/">
    <meta property="og:image" name="og:image" content="/assets/logo.png">
    <meta property="og:description" name="og:description" content="Eventvwr.exe is a living-of-the-land file containing unexpected functionality that can be abused by attackers; this page lists all its use cases.">
</head>
<body>
    <a href="https://github.com/LOLBAS-Project/LOLBAS" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    	<h1><a href="/">..</a> /Eventvwr.exe<div class="github-buttons">
        <a class="github-button" href="https://github.com/LOLBAS-Project/LOLBAS" data-icon="octicon-star" data-show-count="true" aria-label="Star LOLBAS-Project/LOLBAS on GitHub">Star</a>
    </div>
</h1>

	<div class="function-list"><div><a href="/lolbas/Binaries/Eventvwr/#uac%20bypass">UAC bypass (GUI)</a></div></div>

	<p>Displays Windows Event Logs in a GUI window.</p>


	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-133649096-1"></script>
	<script>
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());

	gtag('config', 'UA-133649096-1');
	</script>

	<script src="/assets/url_helper.js"></script>
	<section>
		<h3>Paths:</h3>
		<ul style="list-style-type:none">
			<li data-file-path>C:\Windows\System32\eventvwr.exe</li>
			<li data-file-path>C:\Windows\SysWOW64\eventvwr.exe</li>
		</ul>
	</section>
	<section>
		<h3>Resources:</h3>
		<ul>
			<li><a href="https://enigma0x3.net/2016/08/15/fileless-uac-bypass-using-eventvwr-exe-and-registry-hijacking/">https://enigma0x3.net/2016/08/15/fileless-uac-bypass-using-eventvwr-exe-and-registry-hijacking/</a></li>
			<li><a href="https://github.com/enigma0x3/Misc-PowerShell-Stuff/blob/master/Invoke-EventVwrBypass.ps1">https://github.com/enigma0x3/Misc-PowerShell-Stuff/blob/master/Invoke-EventVwrBypass.ps1</a></li>
			<li><a href="https://twitter.com/orange_8361/status/1518970259868626944">https://twitter.com/orange_8361/status/1518970259868626944</a></li>
		</ul>
	</section>
	
	<section>
		<h3>Acknowledgements:</h3>
		<ul>
			<li>Matt Nelson (<a href="https://twitter.com/@enigma0x3">@enigma0x3</a>)</li>
			<li>Matt Graeber (<a href="https://twitter.com/@mattifestation">@mattifestation</a>)</li>
			<li>Orange Tsai (<a href="https://twitter.com/@orange_8361">@orange_8361</a>)</li>
		</ul>
	</section>
	
	<section>
		<h3>Detections:</h3>
		<ul>
			<li>Sigma: <a href="https://github.com/SigmaHQ/sigma/blob/62d4fd26b05f4d81973e7c8e80d7c1a0c6a29d0e/rules/windows/process_creation/proc_creation_win_uac_bypass_eventvwr.yml" target="_blank" data-shorten="true">https://github.com/SigmaHQ/sigma/blob/62d4fd26b05f4d81973e7c8e80d7c1a0c6a29d0e/rules/windows/process_creation/proc_creation_win_uac_bypass_eventvwr.yml</a></li>
			<li>Sigma: <a href="https://github.com/SigmaHQ/sigma/blob/62d4fd26b05f4d81973e7c8e80d7c1a0c6a29d0e/rules/windows/registry/registry_set/registry_set_uac_bypass_eventvwr.yml" target="_blank" data-shorten="true">https://github.com/SigmaHQ/sigma/blob/62d4fd26b05f4d81973e7c8e80d7c1a0c6a29d0e/rules/windows/registry/registry_set/registry_set_uac_bypass_eventvwr.yml</a></li>
			<li>Sigma: <a href="https://github.com/SigmaHQ/sigma/blob/197615345b927682ab7ad7fa3c5f5bb2ed911eed/rules/windows/file/file_event/file_event_win_uac_bypass_eventvwr.yml" target="_blank" data-shorten="true">https://github.com/SigmaHQ/sigma/blob/197615345b927682ab7ad7fa3c5f5bb2ed911eed/rules/windows/file/file_event/file_event_win_uac_bypass_eventvwr.yml</a></li>
			<li>Elastic: <a href="https://github.com/elastic/detection-rules/blob/d31ea6253ea40789b1fc49ade79b7ec92154d12a/rules/windows/privilege_escalation_uac_bypass_event_viewer.toml" target="_blank" data-shorten="true">https://github.com/elastic/detection-rules/blob/d31ea6253ea40789b1fc49ade79b7ec92154d12a/rules/windows/privilege_escalation_uac_bypass_event_viewer.toml</a></li>
			<li>Splunk: <a href="https://github.com/splunk/security_content/blob/86a5b644a44240f01274c8b74d19a435c7dae66e/detections/endpoint/eventvwr_uac_bypass.yml" target="_blank" data-shorten="true">https://github.com/splunk/security_content/blob/86a5b644a44240f01274c8b74d19a435c7dae66e/detections/endpoint/eventvwr_uac_bypass.yml</a></li>
			<li>IOC: eventvwr.exe launching child process other than mmc.exe</li>
			<li>IOC: Creation or modification of the registry value HKCU\Software\Classes\mscfile\shell\open\command</li>
		</ul>
	</section>

	<section>
		<h2 id="uac bypass" class="function-name">UAC bypass</h2>
		<ol>
			<li>
				<p>During startup, eventvwr.exe checks the registry value HKCU\Software\Classes\mscfile\shell\open\command for the location of mmc.exe, which is used to open the eventvwr.msc saved console file. If the location of another binary or script is added to this registry value, it will be executed as a high-integrity process without a UAC prompt being displayed to the user.</p>
				<pre><code>eventvwr.exe</code></pre>
				<div class="properties">
					<dl class="row"><dt class="property">Use case</dt><dd>Execute a binary or script as a high-integrity process without a UAC prompt.</dd></dl>
					<dl class="row"><dt class="property">Privileges required</dt><dd>User</dd></dl>
					<dl class="row"><dt class="property">Operating systems</dt><dd>Windows vista, Windows 7, Windows 8, Windows 8.1, Windows 10</dd></dl>
					<dl class="row"><dt class="property">ATT&CK&reg; technique</dt><dd><span data-attack-tid="T1548.002">T1548.002</span></dd></dl><dl class="tags row"><dt class="property">Tags</dt><dd><div class="tag">Application: GUI<div class="tag-tooltip">This LOLBAS will cause a graphical user interface (GUI) to be displayed.</div></div></dd></dl>
				</div>
			</li><li>
				<p>During startup, eventvwr.exe uses .NET deserialization with %LOCALAPPDATA%\Microsoft\EventV~1\RecentViews file. This file can be created using https://github.com/pwntester/ysoserial.net</p>
				<pre><code>ysoserial.exe -o raw -f BinaryFormatter - g DataSet -c calc &gt; RecentViews &amp; copy RecentViews %LOCALAPPDATA%\Microsoft\EventV~1\RecentViews &amp; eventvwr.exe</code></pre>
				<div class="properties">
					<dl class="row"><dt class="property">Use case</dt><dd>Execute a command to bypass security restrictions that limit the use of command-line interpreters.</dd></dl>
					<dl class="row"><dt class="property">Privileges required</dt><dd>Administrator</dd></dl>
					<dl class="row"><dt class="property">Operating systems</dt><dd>Windows 7, Windows 8, Windows 8.1, Windows 10</dd></dl>
					<dl class="row"><dt class="property">ATT&CK&reg; technique</dt><dd><span data-attack-tid="T1548.002">T1548.002</span></dd></dl><dl class="tags row"><dt class="property">Tags</dt><dd><div class="tag">Application: GUI<div class="tag-tooltip">This LOLBAS will cause a graphical user interface (GUI) to be displayed.</div></div></dd></dl>
				</div>
			</li>
		</ol>
	</section>

    <script>
        // add permalink on headings
        document.querySelectorAll('h2').forEach((heading) => {
            const link = document.createElement('a');
            link.className = 'permalink';
            link.href = `#${heading.id}`;
            heading.appendChild(link);
        });
    </script>
</body>
</html>
